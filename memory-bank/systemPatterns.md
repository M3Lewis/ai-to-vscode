# 系统模式

## 架构模式

### 1. Chrome扩展三层架构
```
┌─────────────────┐
│   Content Script │ ← 用户交互层
├─────────────────┤
│   Background     │ ← 业务逻辑层
├─────────────────┤
│   WebSocket      │ ← 通信层
└─────────────────┘
```

### 2. 消息传递模式
- **Content → Background**: 通过`chrome.runtime.sendMessage`
- **Background → Content**: 通过`chrome.tabs.sendMessage`
- **Background → VS Code**: 通过WebSocket连接

### 3. 状态管理模式
- **连接状态**: 全局状态，通过事件广播
- **配置状态**: 持久化存储，使用Chrome Storage API
- **UI状态**: 本地状态，组件内部管理

## 设计模式

### 1. 观察者模式
- 连接状态变化通知
- 配置变更监听
- 消息队列处理

### 2. 策略模式
- 不同网站的复制策略
- 文件名生成策略
- 内容清理策略

### 3. 工厂模式
- 消息对象创建
- 配置对象创建
- 通知对象创建

## 代码组织模式

### 1. 模块化设计
- 类型定义独立模块
- 工具函数独立模块
- 主要功能类封装

### 2. 错误处理模式
- 统一错误响应格式
- 用户友好的错误提示
- 自动重试机制

### 3. 异步处理模式
- Promise-based异步操作
- 超时处理机制
- 队列管理

## 数据流模式

### 1. 内容提取流程
```
用户点击 → 查找按钮 → 点击复制 → 读取剪贴板 → 内容验证 → 发送到VS Code
```

### 2. 连接管理流程
```
启动扩展 → 建立WebSocket → 状态广播 → 消息处理 → 断线重连
```

### 3. 配置管理流程
```
默认配置 → 用户设置 → 存储同步 → 实时更新 → 页面重载
```

## 性能优化模式

### 1. 延迟加载
- 按需创建UI元素
- 懒加载配置数据
- 异步初始化

### 2. 缓存策略
- 连接状态缓存
- 配置数据缓存
- 消息队列缓存

### 3. 资源管理
- 定时器清理
- 事件监听器清理
- 内存泄漏防护
