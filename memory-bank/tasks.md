# 任务跟踪

## 当前任务
**任务ID**: PROMPT-FEATURE-001
**任务类型**: 提示词管理功能开发
**复杂度级别**: Level 2 (简单增强)
**状态**: 计划中

## 任务描述
为Chrome扩展添加提示词管理功能，允许用户配置和管理多个提示词模板，并在AI Studio中快速应用。

## 功能需求分析
基于plan1.md中的详细计划，需要实现以下核心功能：

### 1. 提示词配置管理
- 用户可以通过文件选择器添加Markdown格式的提示词
- 支持提示词的增删改查操作
- 提示词内容直接存储在扩展中（而非文件路径）

### 2. AI Studio集成
- 在Google AI Studio页面显示配置的提示词按钮
- 点击按钮自动填充System Instructions
- 支持多个提示词模板切换

### 3. 用户界面优化
- 扩展弹窗界面添加提示词管理区域
- 文件选择器支持.md/.markdown/.txt格式
- 实时显示提示词内容长度和状态

## 开发计划

### 阶段1: 界面和类型定义 (预计2-3小时)
- [ ] **1.1 更新types.ts**
  - 修改PromptFile接口，path字段存储内容而非路径
  - 添加相关类型定义和注释

- [ ] **1.2 修改popup.html**
  - 添加提示词管理区域UI
  - 实现文件选择器界面
  - 添加提示词列表显示区域

### 阶段2: 弹窗功能实现 (预计3-4小时)
- [ ] **2.1 更新popup.ts**
  - 添加文件选择处理逻辑
  - 实现提示词添加/删除功能
  - 实现提示词列表渲染
  - 添加文件内容读取和验证

- [ ] **2.2 数据存储管理**
  - 使用Chrome Storage API存储提示词
  - 实现配置的持久化保存
  - 添加数据验证和错误处理

### 阶段3: 内容脚本集成 (预计2-3小时)
- [ ] **3.1 更新content.ts**
  - 修改createPromptButtons方法，直接使用内容
  - 实现applyPrompt方法，自动填充System Instructions
  - 添加对话框关闭逻辑
  - 优化错误处理和用户反馈

- [ ] **3.2 AI Studio适配**
  - 实现System Instructions按钮查找
  - 添加文本框定位和内容填充
  - 实现Angular事件触发机制

### 阶段4: 后台脚本清理 (预计1小时)
- [ ] **4.1 更新background.ts**
  - 删除文件读取相关代码
  - 保持现有WebSocket通信功能
  - 优化消息处理逻辑

### 阶段5: 测试和优化 (预计2-3小时)
- [ ] **5.1 功能测试**
  - 测试文件选择和加载
  - 测试提示词添加和删除
  - 测试AI Studio集成功能

- [ ] **5.2 用户体验优化**
  - 添加加载状态指示
  - 优化错误提示信息
  - 改进界面交互体验

- [ ] **5.3 构建和部署**
  - 执行npm run build
  - 测试扩展加载和功能
  - 验证所有功能正常工作

## 技术实现要点

### 文件处理策略
- 使用HTML5 File API读取本地文件
- 支持.md/.markdown/.txt格式
- 文件内容直接存储在Chrome Storage中

### AI Studio集成策略
- 通过DOM选择器定位System Instructions按钮
- 使用事件触发机制确保Angular检测到变化
- 实现自动化的界面操作流程

### 数据存储策略
- 使用chrome.storage.sync存储用户配置
- 提示词内容作为字符串直接存储
- 实现配置的版本控制和迁移

## 风险评估和缓解

### 高风险项
- **AI Studio界面变化**: 选择器可能失效
  - 缓解: 使用多个备选选择器，定期更新
- **文件读取权限**: 浏览器安全限制
  - 缓解: 使用标准的File API，避免fetch本地文件

### 中风险项
- **Angular事件触发**: 可能无法正确触发更新
  - 缓解: 使用多种事件类型和自定义事件
- **存储空间限制**: Chrome Storage有大小限制
  - 缓解: 添加内容长度验证和压缩

### 低风险项
- **用户界面兼容性**: 不同Chrome版本差异
  - 缓解: 使用标准HTML5 API

## 成功标准
- [ ] 用户可以成功添加和管理提示词
- [ ] 在AI Studio中可以正常应用提示词
- [ ] 所有功能在Chrome扩展中正常工作
- [ ] 用户体验流畅，错误处理完善

## 预计总工时
**总计**: 10-14小时
**建议分配**: 2-3天完成

## 下一步行动
准备开始阶段1的开发工作，首先更新types.ts和popup.html文件。
