(()=>{"use strict";class e{static findLatestCopyButton(){const e=performance.now();console.group("ğŸ” [æ€§èƒ½ç›‘æ§] æŸ¥æ‰¾COPYæŒ‰é’®");const t=window.location.hostname;console.log("ğŸ“ å½“å‰åŸŸå:",t),console.log("â±ï¸ å¼€å§‹æ—¶é—´:",(new Date).toLocaleTimeString());let o=null;try{if(t.includes("perplexity.ai"))console.log("ğŸ¯ ä½¿ç”¨ Perplexity ä¸“ç”¨æŸ¥æ‰¾"),o=this.findPerplexityCopyButton();else{const e=this.DEFAULT_SELECTORS.find(e=>t.includes(e.hostname));e?(console.log("âœ… æ‰¾åˆ°é»˜è®¤é…ç½®:",e.name),o=this.findButtonWithConfig(e)):(console.log("âš ï¸ ä½¿ç”¨é€šç”¨ç­–ç•¥æŸ¥æ‰¾"),o=this.findButtonGeneric())}}catch(e){console.error("âŒ æŸ¥æ‰¾æŒ‰é’®æ—¶å‘ç”Ÿé”™è¯¯:",e)}const n=(performance.now()-e).toFixed(2);return console.log("â±ï¸ æŸ¥æ‰¾è€—æ—¶:",n,"ms"),console.log("ğŸ“Š ç»“æœ:",o?"âœ… æ‰¾åˆ°æŒ‰é’®":"âŒ æœªæ‰¾åˆ°æŒ‰é’®"),console.log("ğŸ’¾ å½“å‰å†…å­˜ä½¿ç”¨:",this.getMemoryUsage()),console.groupEnd(),o}static async loadConfigs(){}static findPerplexityCopyButton(){const e=performance.now();console.group("ğŸ” [Perplexity] ä¸“ç”¨æŸ¥æ‰¾");try{console.time("æŸ¥æ‰¾å›å¤å®¹å™¨");const t=document.querySelectorAll("div.py-md.md\\:pb-headerHeight.mx-auto.max-w-threadContentWidth > div");if(console.timeEnd("æŸ¥æ‰¾å›å¤å®¹å™¨"),console.log("ğŸ“¦ å›å¤å®¹å™¨æ•°é‡:",t.length),0===t.length)return console.warn("âŒ æœªæ‰¾åˆ°å›å¤å®¹å™¨"),console.groupEnd(),null;const o=t[t.length-1];console.log("ğŸ“ ä½¿ç”¨æœ€åä¸€ä¸ªå®¹å™¨ (ç´¢å¼•:",t.length-1,")"),console.time("æŸ¥æ‰¾å¤åˆ¶æŒ‰é’®");const n=o.querySelectorAll('button[aria-label*="Copy"], button[data-testid*="copy"]');if(console.timeEnd("æŸ¥æ‰¾å¤åˆ¶æŒ‰é’®"),console.log("ğŸ”˜ å¤åˆ¶æŒ‰é’®æ•°é‡:",n.length),n.length>0){const t=n[n.length-1];return console.log("âœ… é€‰ä¸­æŒ‰é’®:",{ariaLabel:t.getAttribute("aria-label"),dataTestId:t.getAttribute("data-testid"),text:t.textContent?.trim().substring(0,20)}),console.log("â±ï¸ PerplexityæŸ¥æ‰¾è€—æ—¶:",(performance.now()-e).toFixed(2),"ms"),console.groupEnd(),t}console.warn("âš ï¸ æœªæ‰¾åˆ°æ ‡å‡†å¤åˆ¶æŒ‰é’®ï¼Œå°è¯•é€’å½’æœç´¢"),console.time("é€’å½’æœç´¢æŒ‰é’®");const s=Array.from(o.querySelectorAll("button"));console.log("ğŸ” å®¹å™¨å†…æŒ‰é’®æ€»æ•°:",s.length);for(let e=0;e<s.length;e++){const t=s[e],o=t.getAttribute("aria-label")?.toLowerCase()||"",n=t.getAttribute("data-testid")?.toLowerCase()||"",i=t.textContent?.toLowerCase()||"";if(o.includes("copy")||n.includes("copy")||i.includes("copy"))return console.log("âœ… é€’å½’æ‰¾åˆ°æŒ‰é’® (ç´¢å¼•:",e,")"),console.timeEnd("é€’å½’æœç´¢æŒ‰é’®"),console.groupEnd(),t}console.timeEnd("é€’å½’æœç´¢æŒ‰é’®")}catch(e){console.error("âŒ PerplexityæŸ¥æ‰¾å‡ºé”™:",e)}return console.warn("âŒ PerplexityæŸ¥æ‰¾å¤±è´¥"),console.groupEnd(),null}static findButtonWithConfig(e){const t=performance.now();console.group("ğŸ” [é…ç½®æŸ¥æ‰¾]",e.name);const o=e.copyButtonSelector;console.log("ğŸ¯ é€‰æ‹©å™¨:",o);try{if(window.location.hostname.includes("aistudio.google.com")){const e=this.findAIStudioCopyButton();return console.log("â±ï¸ AI StudioæŸ¥æ‰¾è€—æ—¶:",(performance.now()-t).toFixed(2),"ms"),console.groupEnd(),e}if(window.location.hostname.includes("claude.ai")){const e=this.findClaudeCopyButton();return console.log("â±ï¸ ClaudeæŸ¥æ‰¾è€—æ—¶:",(performance.now()-t).toFixed(2),"ms"),console.groupEnd(),e}if(e.responseContainerSelector){console.log("ğŸ“¦ ä½¿ç”¨å®¹å™¨é€‰æ‹©å™¨:",e.responseContainerSelector),console.time("æŸ¥æ‰¾å®¹å™¨");const t=document.querySelectorAll(e.responseContainerSelector);if(console.timeEnd("æŸ¥æ‰¾å®¹å™¨"),console.log("ğŸ“¦ å®¹å™¨æ•°é‡:",t.length),t.length>0){const e=t[t.length-1];console.time("å®¹å™¨å†…æŸ¥æ‰¾æŒ‰é’®");const n=e.querySelector(o);if(console.timeEnd("å®¹å™¨å†…æŸ¥æ‰¾æŒ‰é’®"),n)return console.log("âœ… åœ¨å®¹å™¨ä¸­æ‰¾åˆ°æŒ‰é’®"),console.groupEnd(),n}}console.warn("âš ï¸ å›é€€åˆ°å…¨å±€æŸ¥æ‰¾"),console.time("å…¨å±€æŸ¥æ‰¾æŒ‰é’®");const n=document.querySelectorAll(o);if(console.timeEnd("å…¨å±€æŸ¥æ‰¾æŒ‰é’®"),console.log("ğŸ”˜ å…¨å±€æ‰¾åˆ°æŒ‰é’®æ•°:",n.length),n.length>0)return console.log("âœ… è¿”å›æœ€åä¸€ä¸ªæŒ‰é’®"),console.groupEnd(),n[n.length-1]}catch(e){console.error("âŒ é…ç½®æŸ¥æ‰¾å‡ºé”™:",e)}return console.warn("âŒ æœªæ‰¾åˆ°æŒ‰é’®"),console.log("â±ï¸ æ€»è€—æ—¶:",(performance.now()-t).toFixed(2),"ms"),console.groupEnd(),null}static findClaudeCopyButton(){console.group("ğŸ” [Claude] ä¸“ç”¨æŸ¥æ‰¾");try{console.time("æŸ¥æ‰¾ClaudeæŒ‰é’®");const e=Array.from(document.querySelectorAll('button[data-testid="action-bar-copy"]'));if(console.timeEnd("æŸ¥æ‰¾ClaudeæŒ‰é’®"),console.log("ğŸ”˜ æ‰¾åˆ°æŒ‰é’®æ•°:",e.length),e.length>0)return console.groupEnd(),e[e.length-1];console.warn("âš ï¸ ä½¿ç”¨SVGå¤‡ç”¨æŸ¥æ‰¾"),console.time("SVGè·¯å¾„æŸ¥æ‰¾");const t=Array.from(document.querySelectorAll("button"));console.log("ğŸ” é¡µé¢æŒ‰é’®æ€»æ•°:",t.length),t.length>1e3&&console.error("âŒ æŒ‰é’®æ•°é‡å¼‚å¸¸ (>1000)ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼");for(let e=t.length-1;e>=0;e--){const o=t[e],n=o.querySelector("svg");if(n){const t=n.querySelector("path");if(t){const n=t.getAttribute("d")||"";if(n.includes("M10 1.5C11.1097")||n.includes("clipboard"))return console.log("âœ… é€šè¿‡SVGæ‰¾åˆ° (ç´¢å¼•:",e,")"),console.timeEnd("SVGè·¯å¾„æŸ¥æ‰¾"),console.groupEnd(),o}}}console.timeEnd("SVGè·¯å¾„æŸ¥æ‰¾")}catch(e){console.error("âŒ ClaudeæŸ¥æ‰¾å‡ºé”™:",e)}return console.groupEnd(),null}static findAIStudioCopyButton(){console.group("ğŸ” [AI Studio] ä¸“ç”¨æŸ¥æ‰¾");try{const e=[{name:"jslogå±æ€§",fn:()=>document.querySelector('button[mat-menu-item][jslog^="282205"]')},{name:"copy-markdown-buttonç±»",fn:()=>{const e=document.querySelector(".copy-markdown-button");return e?.closest("button[mat-menu-item]")}},{name:"Copy as markdownæ–‡æœ¬",fn:()=>Array.from(document.querySelectorAll("button[mat-menu-item]")).find(e=>e.textContent?.toLowerCase().includes("copy as markdown"))||null}];for(const t of e){console.time(t.name);const e=t.fn();if(console.timeEnd(t.name),e)return console.log("âœ… ç­–ç•¥æˆåŠŸ:",t.name),console.groupEnd(),e}}catch(e){console.error("âŒ AI StudioæŸ¥æ‰¾å‡ºé”™:",e)}return console.groupEnd(),null}static findButtonGeneric(){console.group("ğŸ” [é€šç”¨ç­–ç•¥] æŸ¥æ‰¾");const e=['button[data-testid*="copy"]','button[aria-label*="Copy" i]','button[aria-label*="å¤åˆ¶" i]','button[title*="Copy" i]',"button.copy-button","button.copy-btn",'[data-testid*="copy"]'];for(const t of e)try{console.time(`é€‰æ‹©å™¨: ${t}`);const e=document.querySelectorAll(t);if(console.timeEnd(`é€‰æ‹©å™¨: ${t}`),console.log(`  ğŸ“Š æ‰¾åˆ° ${e.length} ä¸ªæŒ‰é’®`),e.length>100&&console.warn(`  âš ï¸ æŒ‰é’®æ•°é‡è¿‡å¤š (${e.length})ï¼Œå¯èƒ½å½±å“æ€§èƒ½ï¼`),e.length>0)return console.log("  âœ… è¿”å›æœ€åä¸€ä¸ªæŒ‰é’®"),console.groupEnd(),e[e.length-1]}catch(e){console.error("  âŒ é€‰æ‹©å™¨é”™è¯¯:",e);continue}return console.error("âŒ æ‰€æœ‰é€šç”¨ç­–ç•¥éƒ½å¤±è´¥äº†"),console.groupEnd(),null}static async getClipboardContent(){const e=performance.now();console.group("ğŸ“‹ [å‰ªè´´æ¿] è¯»å–å†…å®¹");try{const t=await navigator.clipboard.readText(),o=(performance.now()-e).toFixed(2);return console.log("âœ… è¯»å–æˆåŠŸ"),console.log("ğŸ“ å†…å®¹é•¿åº¦:",t.length,"å­—ç¬¦"),console.log("â±ï¸ è¯»å–è€—æ—¶:",o,"ms"),t.length>5e4&&console.warn("âš ï¸ å†…å®¹è¿‡å¤§ (>50KB)ï¼Œå¯èƒ½å½±å“æ€§èƒ½ï¼"),console.groupEnd(),t}catch(e){throw console.error("âŒ è¯»å–å¤±è´¥:",e),console.groupEnd(),new Error("æ— æ³•è¯»å–å‰ªè´´æ¿")}}static getMemoryUsage(){if("memory"in performance){const e=performance.memory;return`${(e.usedJSHeapSize/1048576).toFixed(2)} MB / ${(e.totalJSHeapSize/1048576).toFixed(2)} MB`}return"ä¸å¯ç”¨"}static makeDraggable(e){let t,o,n=!1;const s=e.querySelector(".ai-vscode-header");s&&(s.style.cursor="move",s.addEventListener("mousedown",s=>{s.target.closest("button")||(n=!0,t=s.clientX-e.offsetLeft,o=s.clientY-e.offsetTop,e.style.transition="none",e.classList.add("dragging"))}),document.addEventListener("mousemove",s=>{if(!n)return;s.preventDefault();let i=s.clientX-t,l=s.clientY-o;const a=window.innerWidth-e.offsetWidth-10,r=window.innerHeight-e.offsetHeight-10;i=Math.max(10,Math.min(i,a)),l=Math.max(10,Math.min(l,r)),e.style.left=`${i}px`,e.style.top=`${l}px`,e.style.right="auto",e.style.bottom="auto"}),document.addEventListener("mouseup",()=>{n&&(n=!1,e.classList.remove("dragging"),e.style.transition="")}))}}e.DEFAULT_SELECTORS=[{hostname:"chat.openai.com",copyButtonSelector:'button[aria-label*="Copy"]',responseContainerSelector:'[data-message-author-role="assistant"]',name:"ChatGPT"},{hostname:"claude.ai",copyButtonSelector:'button[data-testid="action-bar-copy"]',responseContainerSelector:void 0,name:"Claude"},{hostname:"gemini.google.com",copyButtonSelector:'button[aria-label="Copy"]',responseContainerSelector:".model-response",name:"Gemini"},{hostname:"perplexity.ai",copyButtonSelector:'button[aria-label="Copy"]',responseContainerSelector:void 0,name:"Perplexity"},{hostname:"aistudio.google.com",copyButtonSelector:'button[mat-menu-item][jslog^="282205"]',responseContainerSelector:void 0,name:"AI Studio"}];class t{static injectAnchors(){this.removeAnchors();const e=["BUTTON","A","INPUT","TEXTAREA","SELECT","H1","H2","H3","H4","H5","H6","IMG","svg"],t=Array.from(document.querySelectorAll("*")).filter(t=>{const o=window.getComputedStyle(t);if("none"===o.display||"hidden"===o.visibility||"0"===o.opacity)return!1;const n=t.getBoundingClientRect();return!(n.width<10||n.height<10||!e.includes(t.tagName))}),o=document.createElement("div");o.id=this.overlayId,Object.assign(o.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none",zIndex:"2147483647",overflow:"hidden"}),document.body.appendChild(o);const n=new Map;let s=1;return t.forEach(e=>{const t=e.getBoundingClientRect(),i=window.pageYOffset||document.documentElement.scrollTop,l=window.pageXOffset||document.documentElement.scrollLeft,a=document.createElement("div");a.className=this.anchorClass,Object.assign(a.style,{position:"absolute",top:`${t.top+i}px`,left:`${t.left+l}px`,width:`${t.width}px`,height:`${t.height}px`,border:"2px solid #ff0000",boxSizing:"border-box",pointerEvents:"none"});const r=document.createElement("span");r.textContent=`${s}`,Object.assign(r.style,{position:"absolute",top:"-2px",left:"-2px",backgroundColor:"#ff0000",color:"white",fontSize:"12px",fontWeight:"bold",padding:"0 4px",lineHeight:"14px",zIndex:"1"}),a.appendChild(r),o.appendChild(a),n.set(s,e),e.setAttribute("data-ai-anchor-id",`${s}`),s++}),n}static removeAnchors(){const e=document.getElementById(this.overlayId);e&&e.remove(),document.querySelectorAll("[data-ai-anchor-id]").forEach(e=>{e.removeAttribute("data-ai-anchor-id")})}}t.anchorClass="ai-visual-anchor",t.overlayId="ai-visual-anchor-overlay";class o{constructor(e){this.overlay=null,this.hoveredElement=null,this.isActive=!1,this.onSelect=e,this.handleMouseMove=this.handleMouseMove.bind(this),this.handleClick=this.handleClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}start(){this.isActive||(this.isActive=!0,this.createOverlay(),document.addEventListener("mousemove",this.handleMouseMove,!0),document.addEventListener("click",this.handleClick,!0),document.addEventListener("keydown",this.handleKeyDown,!0),document.body.style.cursor="crosshair")}stop(){this.isActive&&(this.isActive=!1,this.removeOverlay(),document.removeEventListener("mousemove",this.handleMouseMove,!0),document.removeEventListener("click",this.handleClick,!0),document.removeEventListener("keydown",this.handleKeyDown,!0),document.body.style.cursor="",this.hoveredElement=null)}createOverlay(){this.overlay=document.createElement("div"),this.overlay.id="ai-vscode-picker-overlay",Object.assign(this.overlay.style,{position:"fixed",pointerEvents:"none",zIndex:"1000000",border:"2px solid #6c5ce7",backgroundColor:"rgba(108, 92, 231, 0.2)",transition:"all 0.1s ease",display:"none"}),document.body.appendChild(this.overlay)}removeOverlay(){this.overlay&&(this.overlay.remove(),this.overlay=null)}handleMouseMove(e){const t=e.target;if(!t||t===this.overlay||t.closest("#ai-vscode-panel"))return void(this.overlay&&(this.overlay.style.display="none"));this.hoveredElement=t;const o=t.getBoundingClientRect();this.overlay&&Object.assign(this.overlay.style,{display:"block",top:`${o.top}px`,left:`${o.left}px`,width:`${o.width}px`,height:`${o.height}px`})}handleClick(e){this.isActive&&(e.preventDefault(),e.stopPropagation(),this.hoveredElement&&this.onSelect(this.hoveredElement),this.stop())}handleKeyDown(e){"Escape"===e.key&&this.stop()}static getElementInfo(e){const t=e.tagName.toLowerCase(),o=e.id?`#${e.id}`:"",n=Array.from(e.classList).map(e=>`.${e}`).join(""),s=window.getComputedStyle(e);let i="è®¡ç®—æ ·å¼:\n";return["display","position","width","height","margin","padding","border","background-color","color","font-family","font-size","flex","grid","justify-content","align-items"].forEach(e=>{i+=`  ${e}: ${s.getPropertyValue(e)};\n`}),`å…ƒç´ : ${t}${o}${n}\n\nHTML: ${e.outerHTML.split(">")[0]+">"}\n\n${i}\nå†…éƒ¨æ–‡æœ¬: ${e.innerText.substring(0,100)}${e.innerText.length>100?"...":""}`}}new class{constructor(){this.panel=null,this.statusElement=null,this.enabled=!1,this.dailyCounter=1,this.promptButtons=null,this.isDebugMode=!1,this.pathMemory={},this.picker=null,this.lastSelectedElement=null,this.initialize(),this.checkDebugMode(),this.setupStorageListener()}setUIVisibility(e){this.panel&&(this.panel.style.display=e?"block":"none"),document.querySelectorAll(".notification").forEach(t=>{t.style.display=e?"block":"none"})}checkDebugMode(){this.isDebugMode=window.location.search.includes("debug=true")||"true"===localStorage.getItem("ai-vscode-debug")||"localhost"===window.location.hostname}debugLog(e,...t){this.isDebugMode&&console.log(e,...t)}debugWarn(e,...t){this.isDebugMode&&console.warn(e,...t)}async initialize(){await this.checkAndInitialize(),await this.loadDailyCounter(),await this.loadPathMemory(),this.queryConnectionStatus()}queryConnectionStatus(){chrome.runtime.sendMessage({action:"getConnectionStatus"},e=>{chrome.runtime.lastError?console.error("æŸ¥è¯¢è¿æ¥çŠ¶æ€å¤±è´¥:",chrome.runtime.lastError):e&&void 0!==e.connected&&(console.log("å½“å‰è¿æ¥çŠ¶æ€:",e.connected?"å·²è¿æ¥":"æœªè¿æ¥"),this.updateConnectionStatus(e.connected))})}async loadDailyCounter(){const e=(new Date).toDateString(),t=await chrome.storage.local.get(["lastSaveDate","dailyCounter"]);t.lastSaveDate===e?this.dailyCounter=(t.dailyCounter||0)+1:this.dailyCounter=1}async updateDailyCounter(){const e=(new Date).toDateString();await chrome.storage.local.set({lastSaveDate:e,dailyCounter:this.dailyCounter}),this.dailyCounter++}async loadPathMemory(){const e=await chrome.storage.local.get(["activeProject"]),t=e.activeProject?.rootPath||"default",o=`pathMemory_${t}`,n=await chrome.storage.local.get([o]);this.pathMemory=n[o]||{},console.log(`ğŸ“‚ [${t}] è·¯å¾„è®°å¿†å·²åŠ è½½:`,Object.keys(this.pathMemory).length,"ä¸ªæ–‡ä»¶")}async savePathMemory(){const e=await chrome.storage.local.get(["activeProject"]),t=`pathMemory_${e.activeProject?.rootPath||"default"}`;await chrome.storage.local.set({[t]:this.pathMemory})}setupStorageListener(){chrome.storage.onChanged.addListener((e,t)=>{"local"===t&&e.activeProject&&(console.log("ğŸ”„ æ£€æµ‹åˆ°æ´»è·ƒé¡¹ç›®å˜æ›´ï¼Œé‡æ–°åŠ è½½è·¯å¾„è®°å¿†"),this.loadPathMemory())})}async checkAndInitialize(){const e=(await chrome.storage.sync.get("settings")).settings||{},t=e.enabledUrls||["chat.openai.com","claude.ai","gemini.google.com","chatgpt.com","poe.com","perplexity.ai","deepseek.com","aistudio.google.com"],o=e.showOnAllSites||!1,n=window.location.hostname;o||this.isUrlEnabled(n,t)?(this.enabled=!0,this.createPanel(),this.setupMessageListener(),console.log("âœ… æ‚¬æµ®çª—å·²å¯ç”¨")):console.log("å½“å‰ç½‘ç«™æœªå¯ç”¨æ‚¬æµ®çª—:",n),chrome.storage.onChanged.addListener(e=>{e.settings&&window.location.reload()})}isUrlEnabled(e,t){return t.some(t=>{if(t.includes("*")){const o=t.replace(/\*/g,".*");return new RegExp(o).test(e)}return e.includes(t)})}createPanel(){this.panel=document.createElement("div"),this.panel.id="ai-vscode-panel",this.panel.setAttribute("data-html2canvas-ignore","true"),this.panel.innerHTML='\n    <div class="panel-container">\n      <div class="ai-vscode-header">\n        <span class="ai-vscode-title">å‘é€åˆ°VS Code</span>\n        <button id="toggle-prompts" class="ai-vscode-toggle" title="æŠ˜å /å±•å¼€æç¤ºè¯">â–¾</button>\n        <button id="close-panel" class="ai-vscode-close">âœ•</button>\n      </div>\n      <div id="filename-preview" class="filename-preview">æ–‡ä»¶åé¢„è§ˆ...</div>\n\n      <div id="prompt-section">\n        <div class="prompt-section-header">\n          <span>å¸¸ç”¨æç¤ºè¯</span>\n        </div>\n        <div id="prompt-buttons" class="prompt-buttons"></div>\n      </div>\n\n      <div class="ai-vscode-footer">\n        <div class="button-group">\n          <button id="send-to-vscode" class="primary">å¤åˆ¶å¹¶ä¿å­˜</button>\n          <button id="create-files-from-content" class="secondary" title="è¯†åˆ«ä»£ç å—ä¸­çš„è·¯å¾„å¹¶ç›´æ¥åˆ›å»ºæ–‡ä»¶">è¯†åˆ«å¹¶åˆ›å»º</button>\n          <button id="patch-files-from-content" class="secondary" title="æ™ºèƒ½è¯†åˆ«è·¯å¾„å¹¶å±€éƒ¨æ›´æ–°æ–‡ä»¶å†…å®¹">å±€éƒ¨æ›´æ–°</button>\n        </div>\n        <div class="button-group" style="margin-top: 8px;">\n          <button id="screenshot-element" class="secondary" title="é€‰æ‹©å…ƒç´ å¹¶æˆªå›¾ï¼ˆå¸¦çº¢æ¡†ï¼‰">æˆªå›¾å…ƒç´ </button>\n          <button id="copy-element" class="secondary" title="é€‰æ‹©å…ƒç´ å¹¶å¤åˆ¶å…¶ä»£ç ">å¤åˆ¶å…ƒç´ </button>\n          <button id="send-screenshot" class="secondary" title="æˆªå–å½“å‰é¡µé¢å¹¶å‘é€åˆ° VS Code">å…¨å±æˆªå›¾</button>\n          <button id="clone-page" class="secondary" title="å¤åˆ»å½“å‰é¡µé¢ï¼šæ³¨å…¥é”šç‚¹ -> æˆªå›¾ -> æå–æ•°æ® -> å‘é€">å¤åˆ»é¡µé¢</button>\n        </div>\n        <div id="connection-status" class="connection-status">\n          <span class="status-dot"></span>\n          <span class="status-text">æœªè¿æ¥</span>\n        </div>\n      </div>\n    </div>\n  ',document.body.appendChild(this.panel),e.makeDraggable(this.panel);const t=document.getElementById("send-to-vscode");t?.addEventListener("click",()=>this.handleSendClick());const o=document.getElementById("create-files-from-content");o?.addEventListener("click",()=>this.handleCreateFilesClick());const n=document.getElementById("patch-files-from-content");n?.addEventListener("click",()=>this.handlePartialUpdateClick());const s=document.getElementById("screenshot-element");s?.addEventListener("click",()=>this.handleScreenshotElementClick());const i=document.getElementById("copy-element");i?.addEventListener("click",()=>this.handleCopyElementClick());const l=document.getElementById("send-screenshot");l?.addEventListener("click",()=>this.handleSendScreenshotClick());const a=document.getElementById("clone-page");a?.addEventListener("click",()=>this.handleClonePageClick());const r=document.getElementById("close-panel");r?.addEventListener("click",()=>this.togglePanel());const c=document.getElementById("toggle-prompts"),d=document.getElementById("prompt-section");c&&d&&(c.addEventListener("click",()=>{const e=d.classList.toggle("collapsed");c.textContent=e?"â–¸":"â–¾",chrome.storage.local.set({promptsCollapsed:e})}),chrome.storage.local.get("promptsCollapsed",e=>{e.promptsCollapsed&&(d.classList.add("collapsed"),c.textContent="â–¸")})),this.statusElement=document.getElementById("connection-status"),this.promptButtons=document.getElementById("prompt-buttons"),this.loadPromptButtons()}togglePanel(){this.panel&&(this.panel.style.display="none"===this.panel.style.display?"block":"none")}async handleSendClick(){const t=performance.now();this.setUIVisibility(!1),await this.delay(50),console.group("ğŸš€ [å¤åˆ¶å¹¶ä¿å­˜] å®Œæ•´æµç¨‹"),console.log("â±ï¸ å¼€å§‹æ—¶é—´:",(new Date).toLocaleTimeString()),console.log("ğŸ’¾ åˆå§‹å†…å­˜:",this.getMemoryUsage());try{if(window.location.hostname.includes("aistudio.google.com"))return void await this.handleAIStudioCopy();console.log("\nğŸ“ æ­¥éª¤1: æŸ¥æ‰¾å¤åˆ¶æŒ‰é’®");const o=e.findLatestCopyButton();if(!o)return console.error("âŒ æœªæ‰¾åˆ°COPYæŒ‰é’®"),this.showError("æœªæ‰¾åˆ°COPYæŒ‰é’®"),void console.groupEnd();console.log("\nğŸ“ æ­¥éª¤2: ç‚¹å‡»å¤åˆ¶æŒ‰é’®"),console.time("ç‚¹å‡»å¤åˆ¶"),o.click(),console.timeEnd("ç‚¹å‡»å¤åˆ¶"),console.log("\nğŸ“ æ­¥éª¤3: ç­‰å¾…å¤åˆ¶å®Œæˆ (300ms)"),await this.delay(300),console.log("\nğŸ“ æ­¥éª¤4: è¯»å–å‰ªè´´æ¿");const n=await e.getClipboardContent();if(!n||0===n.trim().length)return console.error("âŒ å‰ªè´´æ¿å†…å®¹ä¸ºç©º"),this.showError("å‰ªè´´æ¿å†…å®¹ä¸ºç©º"),void console.groupEnd();console.log("\nğŸ“ æ­¥éª¤5: ç”Ÿæˆæ–‡ä»¶å"),console.time("ç”Ÿæˆæ–‡ä»¶å");const s=this.generateSmartFilename(n);console.timeEnd("ç”Ÿæˆæ–‡ä»¶å"),console.log("ğŸ“ æ–‡ä»¶å:",s),console.log("\nğŸ“ æ­¥éª¤6: å‘é€åˆ°VS Code"),this.showFilenamePreview(s),this.sendToVSCode(n,s),console.log("\nğŸ“ æ­¥éª¤7: æ›´æ–°è®¡æ•°å™¨"),await this.updateDailyCounter();const i=performance.now();console.log("\nâœ… æµç¨‹å®Œæˆ"),console.log("â±ï¸ æ€»è€—æ—¶:",(i-t).toFixed(2),"ms"),console.log("ğŸ’¾ ç»“æŸå†…å­˜:",this.getMemoryUsage()),console.groupEnd()}catch(e){const t=e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯";console.error("âŒ æµç¨‹å¤±è´¥:",e),console.log("ğŸ’¾ é”™è¯¯æ—¶å†…å­˜:",this.getMemoryUsage()),this.showError(`æ“ä½œå¤±è´¥ï¼š${t}`),console.groupEnd()}finally{this.setUIVisibility(!0),console.groupEnd()}}async handleCreateFilesClick(){this.setUIVisibility(!1),await this.delay(50),console.group("ğŸš€ [è¯†åˆ«å¹¶åˆ›å»ºæ–‡ä»¶] æµç¨‹å¼€å§‹");try{let t="";if(window.location.hostname.includes("aistudio.google.com")){const o=Array.from(document.querySelectorAll('button[aria-label*="options"], button[iconname="more_vert"], ms-chat-turn-options button'));if(o.length>0){o[o.length-1].click(),await this.delay(500);const n=e.findLatestCopyButton();n&&(n.click(),await this.delay(300),t=await e.getClipboardContent())}}else{const o=e.findLatestCopyButton();o&&(o.click(),await this.delay(300),t=await e.getClipboardContent())}if(!t||0===t.trim().length)return this.showError("æœªè·å–åˆ°å†…å®¹ï¼Œè¯·ç¡®ä¿é¡µé¢ä¸Šæœ‰å¯å¤åˆ¶çš„å›ç­”"),void console.groupEnd();const o=this.parseFilesFromContent(t);if(0===o.length)return this.showError("æœªåœ¨ä»£ç å—ä¸­è¯†åˆ«åˆ°æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„"),void console.groupEnd();console.log(`ğŸ” è¯†åˆ«åˆ° ${o.length} ä¸ªæ–‡ä»¶:`,o.map(e=>e.path));let n=0;for(const e of o)try{await this.sendToVSCode(e.content,e.filename,e.savePath),n++}catch(t){console.error(`ä¿å­˜æ–‡ä»¶ ${e.path} å¤±è´¥:`,t)}n>0?(this.showSuccess(`âœ… æˆåŠŸè¯†åˆ«å¹¶åˆ›å»º ${n} ä¸ªæ–‡ä»¶`),await this.updateDailyCounter()):this.showError("åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¿æ¥")}catch(e){console.error("è¯†åˆ«å¹¶åˆ›å»ºæ–‡ä»¶å¤±è´¥:",e),this.showError("è¯†åˆ«å¹¶åˆ›å»ºæ–‡ä»¶å¤±è´¥")}finally{this.setUIVisibility(!0),console.groupEnd()}}async handlePartialUpdateClick(){this.setUIVisibility(!1),await this.delay(50),console.group("ğŸš€ [å±€éƒ¨æ›´æ–°æ–‡ä»¶] æµç¨‹å¼€å§‹");try{let t="";if(window.location.hostname.includes("aistudio.google.com")){const o=Array.from(document.querySelectorAll('button[aria-label*="options"], button[iconname="more_vert"], ms-chat-turn-options button'));if(o.length>0){o[o.length-1].click(),await this.delay(500);const n=e.findLatestCopyButton();n&&(n.click(),await this.delay(300),t=await e.getClipboardContent())}}else{const o=e.findLatestCopyButton();o&&(o.click(),await this.delay(300),t=await e.getClipboardContent())}if(!t||0===t.trim().length)return this.showError("æœªè·å–åˆ°å†…å®¹"),void console.groupEnd();const o=this.parseFilesFromContent(t);if(0===o.length)return this.showError("æœªè¯†åˆ«åˆ°æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„"),void console.groupEnd();console.log(`ğŸ” è¯†åˆ«åˆ° ${o.length} ä¸ªæ›´æ–°é¡¹:`,o.map(e=>e.path));let n=0;for(const e of o)try{await this.sendToVSCode(e.content,e.filename,e.savePath,"patch"),n++}catch(t){console.error(`æ›´æ–°æ–‡ä»¶ ${e.path} å¤±è´¥:`,t)}n>0?(this.showSuccess(`âœ… æˆåŠŸå‘é€ ${n} ä¸ªå±€éƒ¨æ›´æ–°è¯·æ±‚`),await this.updateDailyCounter()):this.showError("æ›´æ–°è¯·æ±‚å‘é€å¤±è´¥")}catch(e){console.error("å±€éƒ¨æ›´æ–°å¤±è´¥:",e),this.showError("å±€éƒ¨æ›´æ–°å¤±è´¥")}finally{this.setUIVisibility(!0),console.groupEnd()}}handleScreenshotElementClick(){this.picker||(this.picker=new o(async e=>{this.lastSelectedElement=e,await this.handleCaptureWithText(null,e)})),this.picker.start(),this.showNotification("è¯·é€‰æ‹©è¦æˆªå›¾çš„å…ƒç´  (Esc é€€å‡º)","success")}handleCopyElementClick(){if(this.lastSelectedElement&&document.body.contains(this.lastSelectedElement)){const e=o.getElementInfo(this.lastSelectedElement);return void navigator.clipboard.writeText(e).then(()=>{this.showSuccess("âœ… å·²å¤åˆ¶ä¸Šæ¬¡é€‰ä¸­å…ƒç´ çš„ä»£ç ")}).catch(e=>{this.showError("å¤åˆ¶å¤±è´¥: "+e)})}this.picker||(this.picker=new o(e=>{this.lastSelectedElement=e;const t=o.getElementInfo(e);navigator.clipboard.writeText(t).then(()=>{this.showSuccess("âœ… å…ƒç´ ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}).catch(e=>{this.showError("å¤åˆ¶å¤±è´¥: "+e)})})),this.picker.start(),this.showNotification("è¯·é€‰æ‹©è¦å¤åˆ¶çš„å…ƒç´  (Esc é€€å‡º)","success")}async handleSendScreenshotClick(){await this.handleCaptureWithText(null)}async handleClonePageClick(){this.setUIVisibility(!1),this.showNotification("æ­£åœ¨å‡†å¤‡å¤åˆ»...","success"),t.injectAnchors(),await this.delay(100),chrome.runtime.sendMessage({action:"captureScreenshot"},async e=>{if(t.removeAnchors(),this.setUIVisibility(!0),!chrome.runtime.lastError&&e&&e.success&&e.dataUrl)try{await this.copyToClipboard(e.dataUrl,null),this.showSuccess("âœ… å¸¦æœ‰æ ‡æ³¨çš„æˆªå›¾å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch(e){console.error("å¤åˆ»å¤„ç†å¤±è´¥:",e),this.showError("å¤åˆ»å¤„ç†å¤±è´¥: "+e)}else this.showError("æˆªå›¾å¤±è´¥ï¼Œæ— æ³•ç»§ç»­å¤åˆ»")})}async handleCaptureWithText(e,t=null){this.setUIVisibility(!1);let o=null;if(t){const e=t.getBoundingClientRect();o=document.createElement("div"),Object.assign(o.style,{position:"fixed",top:`${e.top}px`,left:`${e.left}px`,width:`${e.width}px`,height:`${e.height}px`,border:"3px solid red",zIndex:"1000001",pointerEvents:"none",boxSizing:"border-box"}),o.setAttribute("data-html2canvas-ignore","true"),document.body.appendChild(o)}this.showNotification("æ­£åœ¨æ•è·...","success"),await this.delay(50),chrome.runtime.sendMessage({action:"captureScreenshot"},async t=>{if(this.setUIVisibility(!0),o&&o.remove(),chrome.runtime.lastError)this.showError("æˆªå›¾å¤±è´¥: "+chrome.runtime.lastError.message);else if(t&&t.success)if(t.dataUrl)try{await this.copyToClipboard(t.dataUrl,e);const o=e?"âœ… å…ƒç´ ä¿¡æ¯ä¸æˆªå›¾å·²åˆå¹¶å¤åˆ¶ï¼Œè¯· Ctrl+V ç²˜è´´":"âœ… æˆªå›¾å·²å¤åˆ¶ï¼Œè¯· Ctrl+V ç²˜è´´";this.showSuccess(o)}catch(e){console.error("å¤åˆ¶åˆ°å‰ªè´´æ¿å¤±è´¥:",e),this.showSuccess("âœ… æˆªå›¾å·²å‘é€åˆ° VS Code (å‰ªè´´æ¿å¤åˆ¶å¤±è´¥)")}else this.showSuccess("âœ… æˆªå›¾å·²å‘é€åˆ° VS Code");else this.showError("æˆªå›¾å¤±è´¥: "+(t?.error||"æœªçŸ¥é”™è¯¯"))})}async copyToClipboard(e,t){const o=await fetch(e),n=await o.blob(),s={[n.type]:n};t&&(s["text/plain"]=new Blob([t],{type:"text/plain"}));const i=new ClipboardItem(s);await navigator.clipboard.write([i])}parseFilesFromContent(e){const t=[];let o=!1;console.log("ğŸ” å¼€å§‹åˆ‡ç‰‡è§£æ (Slice First), é•¿åº¦:",e.length);const n=[];let s=0,i=!1;const l=e.split("\n");let a=0;for(let t=0;t<l.length;t++){const o=l[t];if(o.trim().startsWith("```")&&(i=!i),!i&&/^[-]{3,}$/.test(o.trim())){const t=a;t>s&&n.push(e.substring(s,t).trim()),s=a+o.length+1}a+=o.length+1}s<e.length&&n.push(e.substring(s).trim()),console.log(`ğŸ”ª åˆ‡ç‰‡æ•°é‡: ${n.length}`);for(let e=0;e<n.length;e++){const s=n[e],i=[/(?:æ–‡ä»¶å|File\s*(?:Name|Path)?|è·¯å¾„|åç§°)[:ï¼š]\s*[`"]?([a-zA-Z0-9._\-\/]+\.[a-zA-Z0-9]+)[`"]?/i,/(?:\*\*|__|\`)([a-zA-Z0-9._\-\/]+\.[a-zA-Z0-9]+)(?:\*\*|__|\`)/,/^([a-zA-Z0-9._\-\/]+\.[a-zA-Z0-9]{1,10})$/m];let l=null;for(const t of i){const o=s.match(t);if(o&&o[1]){l=o[1],console.log(`ğŸ¯ åˆ‡ç‰‡ ${e}: æ£€æµ‹åˆ°è·¯å¾„ "${l}"`);break}}if(!l){console.log(`â­ï¸ åˆ‡ç‰‡ ${e}: æœªæ£€æµ‹åˆ°è·¯å¾„ï¼Œè·³è¿‡ (å‰50å­—ç¬¦: "${s.substring(0,50).replace(/\n/g,"\\n")}...")`);continue}const a=s.match(/```(\w+)?[\r\n]+/);if(!a){console.log(`âš ï¸ åˆ‡ç‰‡ ${e}: è·¯å¾„ "${l}" åæœªæ‰¾åˆ°ä»£ç å—å¼€å§‹`);continue}const r=a[1]||"text",c=a.index+a[0].length,d=s.lastIndexOf("```");if(d<=c){console.log(`âš ï¸ åˆ‡ç‰‡ ${e}: è·¯å¾„ "${l}" çš„ä»£ç å—æœªæ­£ç¡®é—­åˆ`);continue}const h=s.substring(c,d).trim();console.log(`ğŸ“¦ åˆ‡ç‰‡ ${e}: ä»£ç å—é•¿åº¦ ${h.length} chars`);let u=l.replace(/^\.?\//,"");const m=u.split("/"),g=m.pop()||"";let p=m.join("/");if(console.log(`ğŸ“‚ è·¯å¾„è§£æ: fullPath="${u}", filename="${g}", savePath="${p}"`),!p){const e=g.toLowerCase(),t=Object.keys(this.pathMemory).find(t=>t.toLowerCase()===e);t&&(p=this.pathMemory[t],u=p?`${p}/${g}`:g,console.log(`ğŸ§  è®°å¿†åŒ¹é…: ${g} -> ${p}`))}p&&this.pathMemory[g]!==p&&(this.pathMemory[g]=p,o=!0,console.log(`ğŸ“ æ›´æ–°è·¯å¾„è®°å¿†: ${g} -> ${p}`)),t.push({path:u,filename:g,savePath:p,content:h}),console.log(`âœ… æˆåŠŸæå–: ${u} (è¯­è¨€: ${r}, ${h.length} chars)`)}return o&&this.savePathMemory(),console.log(`ğŸ“¦ æ€»å…±æå– ${t.length} ä¸ªæ–‡ä»¶`),t}async sendToVSCode(e,t,o,n="save"){try{const s=((await chrome.storage.sync.get({savePath:""})).savePath||"").trim();let i=o||"";s&&(i=i?`${s}/${i}`:s);const l={action:"sendToVSCode",content:e,filename:t,savePath:i,type:n};return new Promise((e,t)=>{chrome.runtime.sendMessage(l,o=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):o&&o.success?e():t(new Error(o?.error||"æœªçŸ¥é”™è¯¯"))})})}catch(e){throw e}}getMemoryUsage(){if("memory"in performance){const e=performance.memory;return`${(e.usedJSHeapSize/1048576).toFixed(2)} MB / ${(e.totalJSHeapSize/1048576).toFixed(2)} MB`}return"ä¸å¯ç”¨"}async handleAIStudioCopy(){try{this.debugLog("ğŸ” AI Studio ç‰¹æ®Šå¤„ç†ï¼šæŸ¥æ‰¾èœå•æŒ‰é’®");const t=Array.from(document.querySelectorAll('button[aria-label*="options"], button[iconname="more_vert"], button[aria-label*="Open options"], ms-chat-turn-options button'));if(0===t.length)return void this.showError("æœªæ‰¾åˆ°èœå•æŒ‰é’®");const o=t[t.length-1];this.debugLog("âœ… æ‰¾åˆ°èœå•æŒ‰é’®ï¼Œå‡†å¤‡ç‚¹å‡»"),o.click(),this.debugLog("âœ… èœå•å·²å±•å¼€ï¼Œç­‰å¾…åŠ è½½..."),await this.delay(500);const n=e.findLatestCopyButton();if(!n)return console.error("âŒ èœå•å±•å¼€åä»æœªæ‰¾åˆ°å¤åˆ¶æŒ‰é’®"),this.showError("æœªæ‰¾åˆ°å¤åˆ¶æŒ‰é’®"),void o.click();this.debugLog("âœ… æ‰¾åˆ°å¤åˆ¶æŒ‰é’®ï¼Œå‡†å¤‡ç‚¹å‡»"),n.click(),await this.delay(300);const s=await e.getClipboardContent();if(!s||0===s.trim().length)return void this.showError("å‰ªè´´æ¿å†…å®¹ä¸ºç©º");if(this.debugLog("âœ… è¯»å–åˆ°å†…å®¹ï¼Œé•¿åº¦:",s.length),s.length>5e4)return void this.showError("å¯¹è¯å†…å®¹è¿‡é•¿ï¼Œæ— æ³•ç›´æ¥å¤åˆ¶ï¼Œè¯·åˆ†æ‰¹æ“ä½œï¼");const i=this.generateSmartFilename(s);this.debugLog("ğŸ“ ç”Ÿæˆæ–‡ä»¶å:",i),this.showFilenamePreview(i),this.sendToVSCode(s,i),await this.updateDailyCounter()}catch(e){const t=e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯";console.error("AI Studio å¤åˆ¶å¤±è´¥:",e),this.showError(`æ“ä½œå¤±è´¥ï¼š${t}`)}}generateSmartFilename(e){const t=new Date,o=t.getFullYear()+String(t.getMonth()+1).padStart(2,"0")+String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0")+String(t.getMinutes()).padStart(2,"0")+String(t.getSeconds()).padStart(2,"0"),s=String(this.dailyCounter).padStart(3,"0"),i=this.extractFirstSentence(e),l=this.cleanSentence(i);return`${o}-${n}-${s}-${this.truncateFilename(l,50)}.md`}extractFirstSentence(e){let t=e.trim();t=t.replace(/^#+\s+/gm,""),t=t.replace(/\*\*(.+?)\*\*/g,"$1"),t=t.replace(/\*(.+?)\*/g,"$1"),t=t.replace(/`(.+?)`/g,"$1"),t=t.replace(/\[(.+?)\]\(.+?\)/g,"$1");const o=t.split(/[ã€‚.!?ï¼ï¼Ÿ\n]/);for(const e of o){const t=e.trim();if(t.length>5)return t}return t.substring(0,50).trim()}cleanSentence(e){const t=[/^å¥½çš„[ï¼!ï¼Œ,ã€‚.\s]*/i,/^å½“ç„¶[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æˆ‘ä¼š[^\s]{0,5}/i,/^æˆ‘å°†[^\s]{0,5}/i,/^è®©æˆ‘[^\s]{0,5}/i,/^æ˜ç™½[äº†å—]?[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æ”¶åˆ°[ï¼!ï¼Œ,ã€‚.\s]*/i,/^å¥½[çš„å•¦][ï¼!ï¼Œ,ã€‚.\s]*/i,/^OK[ï¼!ï¼Œ,ã€‚.\s]*/i,/^äº†è§£[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æ²¡é—®é¢˜[ï¼!ï¼Œ,ã€‚.\s]*/i];let o=e;for(const e of t)o=o.replace(e,"");return o=o.replace(/[<>:"/\\|?*\x00-\x1F]/g,""),o=o.replace(/\s+/g,"-"),o=o.replace(/^-+|-+$/g,""),o}truncateFilename(e,t){if(e.length<=t)return e;let o=e.substring(0,t);const n=o.lastIndexOf("-");return n>.7*t&&(o=o.substring(0,n)),o}showFilenamePreview(e){const t=document.getElementById("filename-preview");t&&(t.textContent=`ğŸ“„ ${e}`,t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3))}setupMessageListener(){chrome.runtime.onMessage.addListener(e=>{"connectionStatus"===e.type&&this.updateConnectionStatus("connected"===e.status)})}updateConnectionStatus(e){if(!this.statusElement)return;const t=this.statusElement.querySelector(".status-text"),o=this.statusElement.querySelector(".status-dot");e?(this.statusElement.classList.add("connected"),t&&(t.textContent="å·²è¿æ¥"),o&&o.classList.add("active")):(this.statusElement.classList.remove("connected"),t&&(t.textContent="æœªè¿æ¥"),o&&o.classList.remove("active"))}showSuccess(e){this.showNotification(e,"success")}showError(e){this.showNotification(e,"error")}showNotification(e,t){const o=document.createElement("div");o.className=`notification ${t}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>o.remove(),3e3)}delay(e){return new Promise(t=>setTimeout(t,e))}async loadPromptButtons(){try{let e=(await chrome.storage.local.get(["promptFiles"])).promptFiles||[];0===e.length&&(e=(await chrome.storage.sync.get(["promptFiles"])).promptFiles||[],e.length>0&&console.log("ä» sync åŠ è½½æç¤ºè¯ï¼ˆæ—§æ ¼å¼ï¼‰")),this.createPromptButtons(e)}catch(e){console.error("åŠ è½½æç¤ºè¯å¤±è´¥:",e)}}createPromptButtons(e){this.promptButtons&&0!==e.length&&(this.promptButtons.innerHTML=e.filter(e=>e.enabled).map(e=>`\n        <button \n          class="prompt-btn" \n          data-prompt-id="${e.id}"\n          data-prompt-name="${this.escapeHtml(e.name)}"\n          style="\n            padding: 8px 12px;\n            background: #6c5ce7;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            text-align: left;\n          "\n        >\n          ğŸ“ ${this.escapeHtml(e.name)}\n        </button>\n      `).join(""),this.promptButtons.querySelectorAll(".prompt-btn").forEach((t,o)=>{const n=t;n.__promptContent=e.filter(e=>e.enabled)[o].path,n.addEventListener("mouseover",()=>{n.style.background="#5f4dd1"}),n.addEventListener("mouseout",()=>{n.style.background="#6c5ce7"}),n.addEventListener("click",e=>{const t=e.currentTarget,o=t.__promptContent,n=t.getAttribute("data-prompt-name");o&&this.applyPrompt(o,n||"")})}))}async applyPrompt(e,t){try{if(console.log("ğŸ“ å¼€å§‹åº”ç”¨æç¤ºè¯:",t),!e||0===e.trim().length)return void this.showError("æç¤ºè¯å†…å®¹ä¸ºç©º");console.log("âœ… å†…å®¹é•¿åº¦:",e.length);const o=document.querySelector('button[data-test-system-instructions-card], button[aria-label="System instructions"], button.system-instructions-card');if(!o)return void this.showError("æœªæ‰¾åˆ° System Instructions æŒ‰é’®");console.log("âœ… æ‰¾åˆ° System Instructions æŒ‰é’®"),o.click(),await this.delay(500);const n=document.querySelector('textarea[aria-label="System instructions"], textarea[placeholder*="tone and style"], textarea.in-run-settings');if(!n)return this.showError("æœªæ‰¾åˆ°æ–‡æœ¬æ¡†"),void this.closeSystemInstructionsDialog();console.log("âœ… æ‰¾åˆ°æ–‡æœ¬æ¡†"),n.value="",n.value=e,n.blur(),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),n.dispatchEvent(new Event("blur",{bubbles:!0}));const s=new CustomEvent("input",{bubbles:!0,cancelable:!0});n.dispatchEvent(s),console.log("âœ… å†…å®¹å·²å¡«å……"),await this.delay(800),this.closeSystemInstructionsDialog(),this.showSuccess(`âœ… å·²åº”ç”¨: ${t}`)}catch(e){const t=e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯";console.error("åº”ç”¨æç¤ºè¯å¤±è´¥:",e),this.showError(`åº”ç”¨å¤±è´¥ï¼š${t}`)}}closeSystemInstructionsDialog(){const e=["button[data-test-close-button]",'button[aria-label="Close panel"]',"button[mat-dialog-close]",'button[iconname="close"]','button.ms-button-icon[iconname="close"]','button[aria-label="Close panel"][data-test-close-button]'];let t=null;for(const o of e)if(t=document.querySelector(o),t&&null!==t.offsetParent){console.log(`âœ… æ‰¾åˆ°å…³é—­æŒ‰é’®: ${o}`);break}if(t){const e=null!==t.offsetParent,o=t.hasAttribute("aria-disabled")&&"true"===t.getAttribute("aria-disabled"),n="false"===t.getAttribute("aria-disabled")||!t.hasAttribute("aria-disabled");if(console.log("å…³é—­æŒ‰é’®çŠ¶æ€:",{isVisible:e,isDisabled:o,isEnabled:n,ariaDisabled:t.getAttribute("aria-disabled"),className:t.className}),e&&n)try{t.click(),console.log("âœ… å·²è‡ªåŠ¨å…³é—­System Instructionsç•Œé¢")}catch(e){console.error("ç‚¹å‡»å…³é—­æŒ‰é’®å¤±è´¥:",e);const o=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(o),console.log("âœ… å·²é€šè¿‡äº‹ä»¶è§¦å‘å…³é—­System Instructionsç•Œé¢")}else console.warn("âŒ å…³é—­æŒ‰é’®ä¸å¯ç”¨æˆ–å·²ç¦ç”¨",{isVisible:e,isDisabled:o,isEnabled:n})}else{console.warn("âŒ æœªæ‰¾åˆ°å¯ç”¨çš„å…³é—­æŒ‰é’®");const e=document.querySelectorAll("button");console.log("é¡µé¢ä¸Šçš„æ‰€æœ‰æŒ‰é’®:",Array.from(e).map(e=>({tagName:e.tagName,className:e.className,ariaLabel:e.getAttribute("aria-label"),dataTest:e.getAttribute("data-test-close-button"),iconName:e.getAttribute("iconname"),matDialogClose:e.getAttribute("mat-dialog-close")})))}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}})();
//# sourceMappingURL=content.js.map