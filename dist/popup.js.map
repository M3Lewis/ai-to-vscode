{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://ai-to-vscode-bridge/./src/popup.ts"],"sourcesContent":["interface SiteConfig {\r\n  hostname: string;\r\n  copyButtonSelector: string;\r\n  responseContainerSelector?: string;\r\n  name?: string;\r\n}\r\n\r\ninterface Settings {\r\n  port: number;\r\n  enabledUrls: string[];\r\n  showOnAllSites: boolean;\r\n  siteConfigs: SiteConfig[];\r\n}\r\n\r\n// ‰øÆÊîπÂéüÊù•ÁöÑ ButtonCandidate Êé•Âè£ÔºåÂéªÊéâ element Â±ûÊÄß\r\ninterface ButtonCandidate {\r\n  selector: string;\r\n  label: string;\r\n  ariaLabel: string;\r\n  text: string;\r\n  score: number;\r\n}\r\n\r\n// Êñ∞Â¢ûÔºöËçâÁ®øÊé•Âè£\r\ninterface DraftSettings {\r\n  port?: number;\r\n  enabledUrls?: string[];\r\n  showOnAllSites?: boolean;\r\n  siteConfigs?: SiteConfig[];\r\n  timestamp?: number;\r\n}\r\n\r\nconst DEFAULT_URLS = [\r\n  'chat.openai.com',\r\n  'claude.ai',\r\n  'gemini.google.com',\r\n  'chatgpt.com',\r\n  'poe.com',\r\n  'perplexity.ai'\r\n];\r\n\r\n\r\nclass PopupManager {\r\n  private autoSaveTimer: number | null = null; // Êñ∞Â¢ûÔºöËá™Âä®‰øùÂ≠òÂÆöÊó∂Âô®\r\n  private hasDraft: boolean = false; // Êñ∞Â¢ûÔºöÊòØÂê¶ÊúâËçâÁ®ø\r\n\r\n  private portInput: HTMLInputElement | null = null;\r\n  private showOnAllSitesCheckbox: HTMLInputElement | null = null;\r\n  private urlList: HTMLElement | null = null;\r\n  private newUrlInput: HTMLInputElement | null = null;\r\n  private saveButton: HTMLButtonElement | null = null;\r\n  private resetButton: HTMLButtonElement | null = null;\r\n  private addUrlButton: HTMLButtonElement | null = null;\r\n  private exportButton: HTMLButtonElement | null = null;\r\n  private importButton: HTMLButtonElement | null = null;\r\n  private importFileInput: HTMLInputElement | null = null;\r\n  private smartFindButton: HTMLButtonElement | null = null;\r\n  private statusDiv: HTMLElement | null = null;\r\n  \r\n  private configList: HTMLElement | null = null;\r\n  private configHostnameInput: HTMLInputElement | null = null;\r\n  private configSelectorInput: HTMLInputElement | null = null;\r\n  private configContainerInput: HTMLInputElement | null = null;\r\n  private addConfigButton: HTMLButtonElement | null = null;\r\n  \r\n  private currentSettings: Settings = {\r\n    port: 8765,\r\n    enabledUrls: [...DEFAULT_URLS],\r\n    showOnAllSites: false,\r\n    siteConfigs: []\r\n  };\r\n\r\n  private selectedCandidate: ButtonCandidate | null = null;\r\n\r\n  constructor() {\r\n    this.initElements();\r\n    this.loadSettings();\r\n    this.setupEventListeners();\r\n    this.setupAutoSave();\r\n  }\r\n\r\n  private initElements(): void {\r\n    this.portInput = document.getElementById('port-input') as HTMLInputElement;\r\n    this.showOnAllSitesCheckbox = document.getElementById('show-on-all-sites') as HTMLInputElement;\r\n    this.urlList = document.getElementById('url-list');\r\n    this.newUrlInput = document.getElementById('new-url-input') as HTMLInputElement;\r\n    this.saveButton = document.getElementById('save-settings') as HTMLButtonElement;\r\n    this.resetButton = document.getElementById('reset-defaults') as HTMLButtonElement;\r\n    this.addUrlButton = document.getElementById('add-url-btn') as HTMLButtonElement;\r\n    this.exportButton = document.getElementById('export-config') as HTMLButtonElement;\r\n    this.importButton = document.getElementById('import-config') as HTMLButtonElement;\r\n    this.importFileInput = document.getElementById('import-file-input') as HTMLInputElement;\r\n    this.smartFindButton = document.getElementById('smart-find-btn') as HTMLButtonElement;\r\n    this.statusDiv = document.getElementById('status');\r\n    \r\n    this.configList = document.getElementById('config-list');\r\n    this.configHostnameInput = document.getElementById('config-hostname') as HTMLInputElement;\r\n    this.configSelectorInput = document.getElementById('config-selector') as HTMLInputElement;\r\n    this.configContainerInput = document.getElementById('config-container') as HTMLInputElement;\r\n    this.addConfigButton = document.getElementById('add-config-btn') as HTMLButtonElement;\r\n  }\r\n\r\n  private async loadSettings(): Promise<void> {\r\n  // ÂÖàÂä†ËΩΩÊ≠£ÂºèÈÖçÁΩÆ\r\n  const settings = await chrome.storage.sync.get({\r\n    port: 8765,\r\n    enabledUrls: [...DEFAULT_URLS],\r\n    showOnAllSites: false,\r\n    siteConfigs: []\r\n  }) as Settings;\r\n\r\n  // Â∞ùËØïÂä†ËΩΩËçâÁ®ø\r\n  const draft = await chrome.storage.local.get('draftSettings');\r\n  \r\n  if (draft.draftSettings) {\r\n    const draftData: DraftSettings = draft.draftSettings;\r\n    \r\n    // Ê£ÄÊü•ËçâÁ®øÊòØÂê¶Âú®5ÂàÜÈíüÂÜÖÔºàÈÅøÂÖçÂä†ËΩΩËøáÊúüËçâÁ®øÔºâ\r\n    const fiveMinutes = 5 * 60 * 1000;\r\n    if (draftData.timestamp && Date.now() - draftData.timestamp < fiveMinutes) {\r\n      // ‰ΩøÁî®ËçâÁ®øË¶ÜÁõñËÆæÁΩÆ\r\n      this.currentSettings = {\r\n        port: draftData.port ?? settings.port,\r\n        enabledUrls: draftData.enabledUrls ?? settings.enabledUrls,\r\n        showOnAllSites: draftData.showOnAllSites ?? settings.showOnAllSites,\r\n        siteConfigs: draftData.siteConfigs ?? settings.siteConfigs\r\n      };\r\n      \r\n      this.hasDraft = true;\r\n      this.showDraftIndicator();\r\n    } else {\r\n      // ËçâÁ®øËøáÊúüÔºå‰ΩøÁî®Ê≠£ÂºèÈÖçÁΩÆ\r\n      this.currentSettings = settings;\r\n      await chrome.storage.local.remove('draftSettings');\r\n    }\r\n  } else {\r\n    this.currentSettings = settings;\r\n  }\r\n\r\n  // Êõ¥Êñ∞UI\r\n  if (this.portInput) this.portInput.value = this.currentSettings.port.toString();\r\n  if (this.showOnAllSitesCheckbox) this.showOnAllSitesCheckbox.checked = this.currentSettings.showOnAllSites;\r\n  \r\n  this.renderUrlList();\r\n  this.renderConfigList();\r\n}\r\n\r\n  // Êñ∞Â¢ûÔºöÊòæÁ§∫ËçâÁ®øÊåáÁ§∫Âô®\r\nprivate showDraftIndicator(): void {\r\n  if (this.saveButton) {\r\n    this.saveButton.textContent = 'üíæ ‰øùÂ≠òËÆæÁΩÆ (ÊúâÊú™‰øùÂ≠òÁöÑÊõ¥Êîπ)';\r\n    this.saveButton.style.background = '#e67e22';\r\n  }\r\n}\r\n\r\n// Êñ∞Â¢ûÔºöÈöêËóèËçâÁ®øÊåáÁ§∫Âô®\r\nprivate hideDraftIndicator(): void {\r\n  if (this.saveButton) {\r\n    this.saveButton.textContent = 'üíæ ‰øùÂ≠òËÆæÁΩÆ';\r\n    this.saveButton.style.background = '#007acc';\r\n  }\r\n  this.hasDraft = false;\r\n}\r\n\r\n// Êñ∞Â¢ûÔºöËÆæÁΩÆËá™Âä®‰øùÂ≠ò\r\nprivate setupAutoSave(): void {\r\n  // ÁõëÂê¨ÊâÄÊúâÂèØËÉΩ‰øÆÊîπÈÖçÁΩÆÁöÑËæìÂÖ•\r\n  this.portInput?.addEventListener('input', () => this.scheduleAutoSave());\r\n  this.showOnAllSitesCheckbox?.addEventListener('change', () => this.scheduleAutoSave());\r\n}\r\n\r\n// Êñ∞Â¢ûÔºöÂª∂ËøüËá™Âä®‰øùÂ≠òÔºàÈò≤Ê≠¢È¢ëÁπÅ‰øùÂ≠òÔºâ\r\nprivate scheduleAutoSave(): void {\r\n  if (this.autoSaveTimer) {\r\n    clearTimeout(this.autoSaveTimer);\r\n  }\r\n\r\n  this.autoSaveTimer = window.setTimeout(() => {\r\n    this.saveDraft();\r\n  }, 500); // 500msÂêé‰øùÂ≠òËçâÁ®ø\r\n}\r\n\r\n// Êñ∞Â¢ûÔºö‰øùÂ≠òËçâÁ®ø\r\nprivate async saveDraft(): Promise<void> {\r\n  const draft: DraftSettings = {\r\n    port: parseInt(this.portInput?.value || '8765'),\r\n    enabledUrls: this.currentSettings.enabledUrls,\r\n    showOnAllSites: this.showOnAllSitesCheckbox?.checked || false,\r\n    siteConfigs: this.currentSettings.siteConfigs,\r\n    timestamp: Date.now()\r\n  };\r\n\r\n  await chrome.storage.local.set({ draftSettings: draft });\r\n  \r\n  if (!this.hasDraft) {\r\n    this.hasDraft = true;\r\n    this.showDraftIndicator();\r\n  }\r\n}\r\n\r\n  private renderUrlList(): void {\r\n    if (!this.urlList) return;\r\n\r\n    if (this.currentSettings.enabledUrls.length === 0) {\r\n      this.urlList.innerHTML = '<div class=\"empty-state\">ÊöÇÊó†ÁΩëÁ´ô</div>';\r\n      return;\r\n    }\r\n\r\n    this.urlList.innerHTML = this.currentSettings.enabledUrls\r\n      .map((url, index) => `\r\n        <div class=\"url-item\">\r\n          <span>${this.escapeHtml(url)}</span>\r\n          <button data-index=\"${index}\">Âà†Èô§</button>\r\n        </div>\r\n      `)\r\n      .join('');\r\n\r\n    this.urlList.querySelectorAll('button').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        const index = parseInt((e.target as HTMLElement).getAttribute('data-index') || '0');\r\n        this.removeUrl(index);\r\n      });\r\n    });\r\n  }\r\n\r\n  private renderConfigList(): void {\r\n    if (!this.configList) return;\r\n\r\n    if (this.currentSettings.siteConfigs.length === 0) {\r\n      this.configList.innerHTML = '<div class=\"empty-state\">ÊöÇÊó†Ëá™ÂÆö‰πâÈÖçÁΩÆ</div>';\r\n      return;\r\n    }\r\n\r\n    this.configList.innerHTML = this.currentSettings.siteConfigs\r\n      .map((config, index) => `\r\n        <div class=\"url-item\">\r\n          <div style=\"flex: 1;\">\r\n            <div style=\"font-weight: 500; color: #fff;\">${this.escapeHtml(config.hostname)}</div>\r\n            <div style=\"font-size: 11px; color: #888; margin-top: 2px;\">\r\n              ${this.escapeHtml(config.copyButtonSelector)}\r\n            </div>\r\n            ${config.responseContainerSelector ? `\r\n              <div style=\"font-size: 10px; color: #666; margin-top: 2px;\">\r\n                ÂÆπÂô®: ${this.escapeHtml(config.responseContainerSelector)}\r\n              </div>\r\n            ` : ''}\r\n          </div>\r\n          <button data-index=\"${index}\">Âà†Èô§</button>\r\n        </div>\r\n      `)\r\n      .join('');\r\n\r\n    this.configList.querySelectorAll('button').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        const index = parseInt((e.target as HTMLElement).getAttribute('data-index') || '0');\r\n        this.removeConfig(index);\r\n      });\r\n    });\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    this.saveButton?.addEventListener('click', () => this.saveSettings());\r\n    this.resetButton?.addEventListener('click', () => this.resetToDefaults());\r\n    this.addUrlButton?.addEventListener('click', () => this.addUrl());\r\n    this.addConfigButton?.addEventListener('click', () => this.addConfig());\r\n    this.exportButton?.addEventListener('click', () => this.exportConfig());\r\n    this.importButton?.addEventListener('click', () => this.importFileInput?.click());\r\n    this.smartFindButton?.addEventListener('click', () => this.smartFindCopyButtons());\r\n    this.importFileInput?.addEventListener('change', (e) => this.handleImportFile(e));\r\n    \r\n    this.newUrlInput?.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') this.addUrl();\r\n    });\r\n\r\n    this.configSelectorInput?.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter' && e.ctrlKey) this.addConfig();\r\n    });\r\n  }\r\nprivate async smartFindCopyButtons(): Promise<void> {\r\n  try {\r\n    const tabs = await chrome.tabs.query({ active: true, currentWindow: true });\r\n    const activeTab = tabs[0];\r\n    \r\n    if (!activeTab || !activeTab.id) {\r\n      this.showStatus('Êó†Ê≥ïËé∑ÂèñÂΩìÂâçÊ†áÁ≠æÈ°µ', 'error');\r\n      return;\r\n    }\r\n\r\n    // Ëá™Âä®Â°´ÂÖÖÂüüÂêç\r\n    if (activeTab.url) {\r\n      try {\r\n        const url = new URL(activeTab.url);\r\n        if (this.configHostnameInput) {\r\n          this.configHostnameInput.value = url.hostname;\r\n        }\r\n      } catch (e) {\r\n        console.error('Ëß£ÊûêURLÂ§±Ë¥•:', e);\r\n      }\r\n    }\r\n\r\n    this.showScanningModal();\r\n\r\n    // Ê≥®ÂÖ•ËÑöÊú¨Êü•ÊâæÊåâÈíÆ\r\n    const results = await chrome.scripting.executeScript({\r\n      target: { tabId: activeTab.id },\r\n      func: () => {\r\n        // === ËøôÊÆµ‰ª£Á†Å‰ºöÂú®ÁõÆÊ†áÈ°µÈù¢‰∏≠ÊâßË°å ===\r\n        // Âú®ËøôÈáåÈáçÊñ∞ÂÆö‰πâÔºåÈÅøÂÖç‰∏éÂ§ñÈÉ®ÂÜ≤Á™Å\r\n        type CandidateResult = {\r\n          selector: string;\r\n          label: string;\r\n          ariaLabel: string;\r\n          text: string;\r\n          score: number;\r\n        };\r\n\r\n        const candidates: CandidateResult[] = [];\r\n        const buttons = document.querySelectorAll('button');\r\n\r\n        buttons.forEach((button) => {\r\n          const text = button.textContent?.toLowerCase().trim() || '';\r\n          const ariaLabel = button.getAttribute('aria-label')?.toLowerCase() || '';\r\n          const title = button.getAttribute('title')?.toLowerCase() || '';\r\n          const className = button.className.toLowerCase();\r\n          \r\n          let score = 0;\r\n          \r\n          // ËØÑÂàÜËßÑÂàô\r\n          if (text.includes('copy') || text.includes('Â§çÂà∂')) score += 10;\r\n          if (ariaLabel.includes('copy') || ariaLabel.includes('Â§çÂà∂')) score += 10;\r\n          if (title.includes('copy') || title.includes('Â§çÂà∂')) score += 5;\r\n          if (className.includes('copy')) score += 5;\r\n          \r\n          const svg = button.querySelector('svg');\r\n          if (svg) score += 2;\r\n          \r\n          // Âè™‰øùÁïôÁõ∏ÂÖ≥Â∫¶Ë∂≥Â§üÈ´òÁöÑÊåâÈíÆ\r\n          if (score >= 5) {\r\n            let selector = '';\r\n            const ariaLabelAttr = button.getAttribute('aria-label');\r\n            \r\n            // ÁîüÊàêÈÄâÊã©Âô®\r\n            if (ariaLabelAttr) {\r\n              // ËΩ¨‰πâÂºïÂè∑\r\n              const escapedLabel = ariaLabelAttr.replace(/\"/g, '\\\\\"');\r\n              selector = `button[aria-label=\"${escapedLabel}\"]`;\r\n            } else if (button.id) {\r\n              selector = `button#${button.id}`;\r\n            } else if (button.className && button.className.trim()) {\r\n              const classes = button.className.trim().split(/\\s+/).slice(0, 2);\r\n              if (classes.length > 0) {\r\n                selector = `button.${classes.join('.')}`;\r\n              } else {\r\n                selector = 'button';\r\n              }\r\n            } else {\r\n              selector = 'button';\r\n            }\r\n\r\n            candidates.push({\r\n              selector: selector,\r\n              label: text || ariaLabel || '(Êó†Ê†áÁ≠æ)',\r\n              ariaLabel: ariaLabelAttr || '',\r\n              text: text,\r\n              score: score\r\n            });\r\n          }\r\n        });\r\n\r\n        // ÊåâÂàÜÊï∞ÊéíÂ∫è\r\n        candidates.sort((a, b) => b.score - a.score);\r\n        \r\n        // ËøîÂõûÂâç10‰∏™\r\n        return candidates.slice(0, 10);\r\n      }\r\n    });\r\n\r\n    const candidates: ButtonCandidate[] = results[0]?.result || [];\r\n\r\n    if (candidates.length === 0) {\r\n      this.showEmptyResultModal();\r\n    } else {\r\n      this.showCandidatesModal(candidates);\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Êô∫ËÉΩÊü•ÊâæÂ§±Ë¥•:', error);\r\n    \r\n    let errorMsg = 'Êô∫ËÉΩÊü•ÊâæÂ§±Ë¥•';\r\n    if (error instanceof Error) {\r\n      errorMsg += ': ' + error.message;\r\n    }\r\n    \r\n    this.showStatus(errorMsg, 'error');\r\n    this.closeModal();\r\n  }\r\n}\r\n\r\n\r\n  private showScanningModal(): void {\r\n    const modal = document.getElementById('smart-find-modal');\r\n    if (!modal) return;\r\n\r\n    modal.innerHTML = `\r\n      <div class=\"modal-content\">\r\n        <div class=\"modal-header\">\r\n          <h3>üîç Ê≠£Âú®Êâ´ÊèèÈ°µÈù¢...</h3>\r\n          <button class=\"modal-close\" id=\"modal-close\">√ó</button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <div class=\"scanning-indicator\">\r\n            <div class=\"spinner\"></div>\r\n            <p style=\"color: #888;\">Ê≠£Âú®Êü•ÊâæCOPYÊåâÈíÆ...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    modal.style.display = 'flex';\r\n    \r\n    document.getElementById('modal-close')?.addEventListener('click', () => {\r\n      this.closeModal();\r\n    });\r\n  }\r\n\r\n  private showEmptyResultModal(): void {\r\n    const modal = document.getElementById('smart-find-modal');\r\n    if (!modal) return;\r\n\r\n    modal.innerHTML = `\r\n      <div class=\"modal-content\">\r\n        <div class=\"modal-header\">\r\n          <h3>üîç Êü•ÊâæÁªìÊûú</h3>\r\n          <button class=\"modal-close\" id=\"modal-close\">√ó</button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <div class=\"empty-result\">\r\n            <div class=\"empty-result-icon\">üòï</div>\r\n            <p>Êú™ÊâæÂà∞COPYÊåâÈíÆ</p>\r\n            <p style=\"font-size: 12px; color: #666; margin-top: 8px;\">\r\n              ËØ∑Á°Æ‰øùÂΩìÂâçÈ°µÈù¢ÊúâAIÂØπËØùÂõûÁ≠îÔºåÂπ∂‰∏îÊúâÂ§çÂà∂ÊåâÈíÆ\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button class=\"btn-cancel\" id=\"modal-cancel\">ÂÖ≥Èó≠</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    modal.style.display = 'flex';\r\n    \r\n    document.getElementById('modal-close')?.addEventListener('click', () => this.closeModal());\r\n    document.getElementById('modal-cancel')?.addEventListener('click', () => this.closeModal());\r\n  }\r\n\r\n  private showCandidatesModal(candidates: ButtonCandidate[]): void {\r\n    const modal = document.getElementById('smart-find-modal');\r\n    if (!modal) return;\r\n\r\n    modal.innerHTML = `\r\n      <div class=\"modal-content\">\r\n        <div class=\"modal-header\">\r\n          <h3>üîç ÊâæÂà∞ ${candidates.length} ‰∏™ÂÄôÈÄâÊåâÈíÆ</h3>\r\n          <button class=\"modal-close\" id=\"modal-close\">√ó</button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <p style=\"margin-bottom: 12px; font-size: 13px; color: #888;\">\r\n            ÁÇπÂáªÈÄâÊã©‰∏Ä‰∏™COPYÊåâÈíÆÔºö\r\n          </p>\r\n          ${candidates.map((c, i) => `\r\n            <div class=\"button-candidate\" data-index=\"${i}\">\r\n              <div class=\"button-info\">\r\n                <div class=\"button-label\">${this.escapeHtml(c.label)}</div>\r\n                <div class=\"button-selector\">${this.escapeHtml(c.selector)}</div>\r\n                <div class=\"button-details\">\r\n                  ${c.ariaLabel ? `aria-label: ${this.escapeHtml(c.ariaLabel)}` : ''}\r\n                  ${c.score ? ` ‚Ä¢ Áõ∏ÂÖ≥Â∫¶: ${c.score}ÂàÜ` : ''}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button class=\"btn-cancel\" id=\"modal-cancel\">ÂèñÊ∂à</button>\r\n          <button class=\"btn-confirm\" id=\"modal-confirm\" disabled>Á°ÆÂÆö</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    modal.style.display = 'flex';\r\n    \r\n    document.getElementById('modal-close')?.addEventListener('click', () => this.closeModal());\r\n    document.getElementById('modal-cancel')?.addEventListener('click', () => this.closeModal());\r\n    document.getElementById('modal-confirm')?.addEventListener('click', () => this.confirmSelection());\r\n    \r\n    const candidateElements = modal.querySelectorAll('.button-candidate');\r\n    candidateElements.forEach((el) => {\r\n      el.addEventListener('click', (e) => {\r\n        const index = parseInt((e.currentTarget as HTMLElement).getAttribute('data-index') || '0');\r\n        this.selectCandidate(index, candidates);\r\n      });\r\n    });\r\n  }\r\n\r\n  private selectCandidate(index: number, candidates: ButtonCandidate[]): void {\r\n    this.selectedCandidate = candidates[index];\r\n    \r\n    const modal = document.getElementById('smart-find-modal');\r\n    if (!modal) return;\r\n    \r\n    modal.querySelectorAll('.button-candidate').forEach(el => {\r\n      el.classList.remove('selected');\r\n    });\r\n    \r\n    const selected = modal.querySelector(`[data-index=\"${index}\"]`);\r\n    selected?.classList.add('selected');\r\n    \r\n    const confirmBtn = document.getElementById('modal-confirm') as HTMLButtonElement;\r\n    if (confirmBtn) confirmBtn.disabled = false;\r\n  }\r\n\r\n  private confirmSelection(): void {\r\n    if (!this.selectedCandidate) return;\r\n    \r\n    if (this.configSelectorInput) {\r\n      this.configSelectorInput.value = this.selectedCandidate.selector;\r\n    }\r\n    \r\n    this.showStatus(`‚úÖ Â∑≤ÈÄâÊã©: ${this.selectedCandidate.selector}`, 'success');\r\n    this.closeModal();\r\n    this.selectedCandidate = null;\r\n  }\r\n\r\n  private closeModal(): void {\r\n    const modal = document.getElementById('smart-find-modal');\r\n    if (modal) {\r\n      modal.style.display = 'none';\r\n      modal.innerHTML = '';\r\n    }\r\n    this.selectedCandidate = null;\r\n  }\r\n\r\n  private addUrl(): void {\r\n    const url = this.newUrlInput?.value.trim();\r\n    if (!url) {\r\n      this.showStatus('ËØ∑ËæìÂÖ•ÁΩëÁ´ôÂüüÂêç', 'error');\r\n      return;\r\n    }\r\n\r\n    if (!/^[\\w\\-.*]+(\\.\\w{2,})?$/.test(url) && url !== 'localhost') {\r\n      this.showStatus('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂüüÂêçÊ†ºÂºè', 'error');\r\n      return;\r\n    }\r\n\r\n    if (this.currentSettings.enabledUrls.includes(url)) {\r\n      this.showStatus('ËØ•ÁΩëÁ´ôÂ∑≤Â≠òÂú®', 'error');\r\n      return;\r\n    }\r\n\r\n    this.currentSettings.enabledUrls.push(url);\r\n    this.renderUrlList();\r\n    \r\n    if (this.newUrlInput) {\r\n      this.newUrlInput.value = '';\r\n    }\r\n    \r\n    this.showStatus('‚úÖ Â∑≤Ê∑ªÂä†ÔºåËØ∑ÁÇπÂáª‰øùÂ≠òËÆæÁΩÆ', 'success');\r\n  }\r\n\r\n  private removeUrl(index: number): void {\r\n    this.currentSettings.enabledUrls.splice(index, 1);\r\n    this.renderUrlList();\r\n    this.showStatus('‚úÖ Â∑≤Âà†Èô§ÔºåËØ∑ÁÇπÂáª‰øùÂ≠òËÆæÁΩÆ', 'success');\r\n  }\r\n\r\n  private addConfig(): void {\r\n    const hostname = this.configHostnameInput?.value.trim();\r\n    const selector = this.configSelectorInput?.value.trim();\r\n    const container = this.configContainerInput?.value.trim();\r\n\r\n    if (!hostname || !selector) {\r\n      this.showStatus('ËØ∑ËæìÂÖ•ÂüüÂêçÂíåCOPYÊåâÈíÆÈÄâÊã©Âô®', 'error');\r\n      return;\r\n    }\r\n\r\n    const exists = this.currentSettings.siteConfigs.some(\r\n      config => config.hostname === hostname\r\n    );\r\n\r\n    if (exists) {\r\n      this.showStatus('ËØ•ÁΩëÁ´ôÈÖçÁΩÆÂ∑≤Â≠òÂú®ÔºåËØ∑ÂÖàÂà†Èô§', 'error');\r\n      return;\r\n    }\r\n\r\n    const newConfig: SiteConfig = {\r\n      hostname,\r\n      copyButtonSelector: selector,\r\n      responseContainerSelector: container || undefined\r\n    };\r\n\r\n    this.currentSettings.siteConfigs.push(newConfig);\r\n    this.renderConfigList();\r\n\r\n    if (this.configHostnameInput) this.configHostnameInput.value = '';\r\n    if (this.configSelectorInput) this.configSelectorInput.value = '';\r\n    if (this.configContainerInput) this.configContainerInput.value = '';\r\n\r\n    this.showStatus('‚úÖ Â∑≤Ê∑ªÂä†ÈÖçÁΩÆÔºåËØ∑ÁÇπÂáª‰øùÂ≠òËÆæÁΩÆ', 'success');\r\n  }\r\n\r\n  private removeConfig(index: number): void {\r\n    this.currentSettings.siteConfigs.splice(index, 1);\r\n    this.renderConfigList();\r\n    this.showStatus('‚úÖ Â∑≤Âà†Èô§ÔºåËØ∑ÁÇπÂáª‰øùÂ≠òËÆæÁΩÆ', 'success');\r\n  }\r\n\r\n  private async saveSettings(): Promise<void> {\r\n    const settings: Settings = {\r\n      port: parseInt(this.portInput?.value || '8765'),\r\n      enabledUrls: this.currentSettings.enabledUrls,\r\n      showOnAllSites: this.showOnAllSitesCheckbox?.checked || false,\r\n      siteConfigs: this.currentSettings.siteConfigs\r\n    };\r\n\r\n    if (settings.port < 1024 || settings.port > 65535) {\r\n      this.showStatus('Á´ØÂè£Âè∑ÂøÖÈ°ªÂú® 1024-65535 ‰πãÈó¥', 'error');\r\n      return;\r\n    }\r\n\r\n    await chrome.storage.sync.set(settings);\r\n    \r\n    this.showStatus('‚úÖ ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºåËØ∑Âà∑Êñ∞ÁΩëÈ°µ‰ΩøÈÖçÁΩÆÁîüÊïà', 'success');\r\n  }\r\n\r\n  private async resetToDefaults(): Promise<void> {\r\n    if (!confirm('Á°ÆÂÆöË¶ÅÊÅ¢Â§çÈªòËÆ§ËÆæÁΩÆÂêóÔºüÊâÄÊúâËá™ÂÆö‰πâÈÖçÁΩÆÂ∞ÜË¢´Ê∏ÖÈô§„ÄÇ')) {\r\n      return;\r\n    }\r\n\r\n    this.currentSettings = {\r\n      port: 8765,\r\n      enabledUrls: [...DEFAULT_URLS],\r\n      showOnAllSites: false,\r\n      siteConfigs: []\r\n    };\r\n\r\n    if (this.portInput) this.portInput.value = '8765';\r\n    if (this.showOnAllSitesCheckbox) this.showOnAllSitesCheckbox.checked = false;\r\n    \r\n    this.renderUrlList();\r\n    this.renderConfigList();\r\n    this.showStatus('‚úÖ Â∑≤ÊÅ¢Â§çÈªòËÆ§ËÆæÁΩÆÔºåËØ∑ÁÇπÂáª‰øùÂ≠ò', 'success');\r\n  }\r\n\r\n  private async exportConfig(): Promise<void> {\r\n    try {\r\n      const data = await chrome.storage.sync.get(null);\r\n      \r\n      const exportData = {\r\n        version: '1.0.0',\r\n        timestamp: new Date().toISOString(),\r\n        extension: 'AI to VSCode Bridge',\r\n        data: data\r\n      };\r\n\r\n      const json = JSON.stringify(exportData, null, 2);\r\n      const blob = new Blob([json], { type: 'application/json' });\r\n      const url = URL.createObjectURL(blob);\r\n      \r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `ai-vscode-bridge-config-${Date.now()}.json`;\r\n      a.click();\r\n      \r\n      URL.revokeObjectURL(url);\r\n      \r\n      this.showStatus('‚úÖ ÈÖçÁΩÆÂ∑≤ÂØºÂá∫', 'success');\r\n    } catch (error) {\r\n      console.error('ÂØºÂá∫Â§±Ë¥•:', error);\r\n      this.showStatus('‚ùå ÂØºÂá∫Â§±Ë¥•: ' + (error as Error).message, 'error');\r\n    }\r\n  }\r\n\r\n  private async handleImportFile(event: Event): Promise<void> {\r\n    const input = event.target as HTMLInputElement;\r\n    const file = input.files?.[0];\r\n    \r\n    if (!file) return;\r\n\r\n    try {\r\n      const text = await file.text();\r\n      const importData = JSON.parse(text);\r\n\r\n      if (!importData.data || !importData.version) {\r\n        this.showStatus('‚ùå Êó†ÊïàÁöÑÈÖçÁΩÆÊñá‰ª∂Ê†ºÂºè', 'error');\r\n        return;\r\n      }\r\n\r\n      if (!confirm('Á°ÆÂÆöË¶ÅÂØºÂÖ•ÈÖçÁΩÆÂêóÔºüÂΩìÂâçÈÖçÁΩÆÂ∞ÜË¢´Ë¶ÜÁõñ„ÄÇ')) {\r\n        return;\r\n      }\r\n\r\n      await chrome.storage.sync.set(importData.data);\r\n      await this.loadSettings();\r\n      \r\n      this.showStatus('‚úÖ ÈÖçÁΩÆÂ∑≤ÂØºÂÖ•ÔºåËØ∑Âà∑Êñ∞ÁΩëÈ°µ‰ΩøÈÖçÁΩÆÁîüÊïà', 'success');\r\n    } catch (error) {\r\n      console.error('ÂØºÂÖ•Â§±Ë¥•:', error);\r\n      this.showStatus('‚ùå ÂØºÂÖ•Â§±Ë¥•: ' + (error as Error).message, 'error');\r\n    } finally {\r\n      input.value = '';\r\n    }\r\n  }\r\n\r\n  private showStatus(message: string, type: 'success' | 'error'): void {\r\n    if (!this.statusDiv) return;\r\n    \r\n    this.statusDiv.textContent = message;\r\n    this.statusDiv.className = type;\r\n    this.statusDiv.style.display = 'block';\r\n    \r\n    setTimeout(() => {\r\n      if (this.statusDiv) {\r\n        this.statusDiv.style.display = 'none';\r\n      }\r\n    }, 4000);\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  new PopupManager();\r\n});\r\n"],"names":["DEFAULT_URLS","PopupManager","constructor","autoSaveTimer","hasDraft","portInput","showOnAllSitesCheckbox","urlList","newUrlInput","saveButton","resetButton","addUrlButton","exportButton","importButton","importFileInput","smartFindButton","statusDiv","configList","configHostnameInput","configSelectorInput","configContainerInput","addConfigButton","currentSettings","port","enabledUrls","showOnAllSites","siteConfigs","selectedCandidate","this","initElements","loadSettings","setupEventListeners","setupAutoSave","document","getElementById","settings","chrome","storage","sync","get","draft","local","draftSettings","draftData","fiveMinutes","timestamp","Date","now","showDraftIndicator","remove","value","toString","checked","renderUrlList","renderConfigList","textContent","style","background","hideDraftIndicator","addEventListener","scheduleAutoSave","clearTimeout","window","setTimeout","saveDraft","parseInt","set","length","innerHTML","map","url","index","escapeHtml","join","querySelectorAll","forEach","btn","e","target","getAttribute","removeUrl","config","hostname","copyButtonSelector","responseContainerSelector","removeConfig","saveSettings","resetToDefaults","addUrl","addConfig","exportConfig","click","smartFindCopyButtons","handleImportFile","key","ctrlKey","activeTab","tabs","query","active","currentWindow","id","showStatus","URL","console","error","showScanningModal","results","scripting","executeScript","tabId","func","candidates","button","text","toLowerCase","trim","ariaLabel","title","className","score","includes","querySelector","selector","ariaLabelAttr","replace","classes","split","slice","push","label","sort","a","b","result","showEmptyResultModal","showCandidatesModal","errorMsg","Error","message","closeModal","modal","display","c","i","confirmSelection","el","currentTarget","selectCandidate","classList","selected","add","confirmBtn","disabled","test","splice","container","some","newConfig","undefined","confirm","data","exportData","version","toISOString","extension","json","JSON","stringify","blob","Blob","type","createObjectURL","createElement","href","download","revokeObjectURL","event","input","file","files","importData","parse","div"],"sourceRoot":""}