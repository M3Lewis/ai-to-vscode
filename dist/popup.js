(()=>{"use strict";const t=["chat.openai.com","claude.ai","gemini.google.com","chatgpt.com","poe.com","perplexity.ai"];class e{constructor(){this.autoSaveTimer=null,this.hasDraft=!1,this.portInput=null,this.showOnAllSitesCheckbox=null,this.urlList=null,this.newUrlInput=null,this.saveButton=null,this.resetButton=null,this.addUrlButton=null,this.exportButton=null,this.importButton=null,this.importFileInput=null,this.smartFindButton=null,this.statusDiv=null,this.configList=null,this.configHostnameInput=null,this.configSelectorInput=null,this.configContainerInput=null,this.addConfigButton=null,this.promptPathInput=null,this.selectFileButton=null,this.promptFileInput=null,this.addPromptButton=null,this.promptList=null,this.fileNameDisplay=null,this.currentFileContent="",this.savePathInput=null,this.currentSettings={port:8765,enabledUrls:[...t],showOnAllSites:!1,siteConfigs:[],promptFiles:[]},this.selectedCandidate=null,this.currentFileName="",this.initElements(),this.loadSettings(),this.setupEventListeners(),this.setupAutoSave()}initElements(){this.portInput=document.getElementById("port-input"),this.showOnAllSitesCheckbox=document.getElementById("show-on-all-sites"),this.urlList=document.getElementById("url-list"),this.newUrlInput=document.getElementById("new-url-input"),this.saveButton=document.getElementById("save-settings"),this.resetButton=document.getElementById("reset-defaults"),this.addUrlButton=document.getElementById("add-url-btn"),this.exportButton=document.getElementById("export-config"),this.importButton=document.getElementById("import-config"),this.importFileInput=document.getElementById("import-file-input"),this.smartFindButton=document.getElementById("smart-find-btn"),this.statusDiv=document.getElementById("status"),this.configList=document.getElementById("config-list"),this.configHostnameInput=document.getElementById("config-hostname"),this.configSelectorInput=document.getElementById("config-selector"),this.configContainerInput=document.getElementById("config-container"),this.addConfigButton=document.getElementById("add-config-btn"),this.promptPathInput=document.getElementById("prompt-path"),this.selectFileButton=document.getElementById("select-file-btn"),this.promptFileInput=document.getElementById("prompt-file-input"),this.addPromptButton=document.getElementById("add-prompt-btn"),this.promptList=document.getElementById("prompt-list"),this.selectFileButton=document.getElementById("select-file-btn"),this.promptFileInput=document.getElementById("prompt-file-input"),this.fileNameDisplay=document.getElementById("file-name-display"),this.savePathInput=document.getElementById("save-path")}async loadSettings(){const e=await chrome.storage.sync.get("settings");let s;s=e.settings?e.settings:await chrome.storage.sync.get({port:8765,enabledUrls:[...t],showOnAllSites:!1,siteConfigs:[],promptFiles:[]});const n=(await chrome.storage.local.get("promptFiles")).promptFiles||[];s.promptFiles=n;const i=await chrome.storage.local.get("draftSettings");if(i.draftSettings){const t=i.draftSettings,e=3e5;t.timestamp&&Date.now()-t.timestamp<e?(this.currentSettings={port:t.port??s.port,enabledUrls:t.enabledUrls??s.enabledUrls,showOnAllSites:t.showOnAllSites??s.showOnAllSites,siteConfigs:t.siteConfigs??s.siteConfigs,promptFiles:t.promptFiles??s.promptFiles},this.hasDraft=!0,this.showDraftIndicator()):(this.currentSettings=s,await chrome.storage.local.remove("draftSettings"))}else this.currentSettings=s;this.savePathInput&&(this.savePathInput.value=this.currentSettings.savePath||""),this.portInput&&(this.portInput.value=this.currentSettings.port.toString()),this.showOnAllSitesCheckbox&&(this.showOnAllSitesCheckbox.checked=this.currentSettings.showOnAllSites),this.renderUrlList(),this.renderConfigList(),this.renderPromptList()}showDraftIndicator(){this.saveButton&&(this.saveButton.textContent="ğŸ’¾ ä¿å­˜è®¾ç½® (æœ‰æœªä¿å­˜çš„æ›´æ”¹)",this.saveButton.style.background="#e67e22")}hideDraftIndicator(){this.saveButton&&(this.saveButton.textContent="ğŸ’¾ ä¿å­˜è®¾ç½®",this.saveButton.style.background="#007acc"),this.hasDraft=!1}setupAutoSave(){this.portInput?.addEventListener("input",()=>this.scheduleAutoSave()),this.showOnAllSitesCheckbox?.addEventListener("change",()=>this.scheduleAutoSave())}scheduleAutoSave(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=window.setTimeout(()=>{this.saveDraft()},500)}async saveDraft(){const t={port:parseInt(this.portInput?.value||"8765"),enabledUrls:this.currentSettings.enabledUrls,showOnAllSites:this.showOnAllSitesCheckbox?.checked||!1,siteConfigs:this.currentSettings.siteConfigs,promptFiles:this.currentSettings.promptFiles,timestamp:Date.now()};await chrome.storage.local.set({draftSettings:t}),this.hasDraft||(this.hasDraft=!0,this.showDraftIndicator())}renderUrlList(){this.urlList&&(0!==this.currentSettings.enabledUrls.length?(this.urlList.innerHTML=this.currentSettings.enabledUrls.map((t,e)=>`\n        <div class="url-item">\n          <span>${this.escapeHtml(t)}</span>\n          <button data-index="${e}">åˆ é™¤</button>\n        </div>\n      `).join(""),this.urlList.querySelectorAll("button").forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.getAttribute("data-index")||"0");this.removeUrl(e)})})):this.urlList.innerHTML='<div class="empty-state">æš‚æ— ç½‘ç«™</div>')}renderConfigList(){this.configList&&(0!==this.currentSettings.siteConfigs.length?(this.configList.innerHTML=this.currentSettings.siteConfigs.map((t,e)=>`\n        <div class="url-item">\n          <div style="flex: 1;">\n            <div style="font-weight: 500; color: #fff;">${this.escapeHtml(t.hostname)}</div>\n            <div style="font-size: 11px; color: #888; margin-top: 2px;">\n              ${this.escapeHtml(t.copyButtonSelector)}\n            </div>\n            ${t.responseContainerSelector?`\n              <div style="font-size: 10px; color: #666; margin-top: 2px;">\n                å®¹å™¨: ${this.escapeHtml(t.responseContainerSelector)}\n              </div>\n            `:""}\n          </div>\n          <button data-index="${e}">åˆ é™¤</button>\n        </div>\n      `).join(""),this.configList.querySelectorAll("button").forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.getAttribute("data-index")||"0");this.removeConfig(e)})})):this.configList.innerHTML='<div class="empty-state">æš‚æ— è‡ªå®šä¹‰é…ç½®</div>')}setupEventListeners(){this.saveButton?.addEventListener("click",()=>this.saveSettings()),this.resetButton?.addEventListener("click",()=>this.resetToDefaults()),this.addUrlButton?.addEventListener("click",()=>this.addUrl()),this.addConfigButton?.addEventListener("click",()=>this.addConfig()),this.exportButton?.addEventListener("click",()=>this.exportConfig()),this.importButton?.addEventListener("click",()=>this.importFileInput?.click()),this.smartFindButton?.addEventListener("click",()=>this.smartFindCopyButtons()),this.importFileInput?.addEventListener("change",t=>this.handleImportFile(t)),this.savePathInput?.addEventListener("input",()=>this.saveDraft()),this.newUrlInput?.addEventListener("keypress",t=>{"Enter"===t.key&&this.addUrl()}),this.configSelectorInput?.addEventListener("keypress",t=>{"Enter"===t.key&&t.ctrlKey&&this.addConfig()}),this.selectFileButton?.addEventListener("click",()=>this.promptFileInput?.click()),this.promptFileInput?.addEventListener("change",t=>this.handleFileSelect(t)),this.addPromptButton?.addEventListener("click",()=>this.addPrompt())}async smartFindCopyButtons(){try{const t=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];if(!t||!t.id)return void this.showStatus("æ— æ³•è·å–å½“å‰æ ‡ç­¾é¡µ","error");if(t.url)try{const e=new URL(t.url);this.configHostnameInput&&(this.configHostnameInput.value=e.hostname)}catch(t){console.error("è§£æURLå¤±è´¥:",t)}this.showScanningModal();const e=await chrome.scripting.executeScript({target:{tabId:t.id},func:()=>{const t=[];return document.querySelectorAll("button").forEach(e=>{const s=e.textContent?.toLowerCase().trim()||"",n=e.getAttribute("aria-label")?.toLowerCase()||"",i=e.getAttribute("title")?.toLowerCase()||"",o=e.className.toLowerCase();let r=0;if((s.includes("copy")||s.includes("å¤åˆ¶"))&&(r+=10),(n.includes("copy")||n.includes("å¤åˆ¶"))&&(r+=10),(i.includes("copy")||i.includes("å¤åˆ¶"))&&(r+=5),o.includes("copy")&&(r+=5),e.querySelector("svg")&&(r+=2),r>=5){let i="";const o=e.getAttribute("aria-label");if(o)i=`button[aria-label="${o.replace(/"/g,'\\"')}"]`;else if(e.id)i=`button#${e.id}`;else if(e.className&&e.className.trim()){const t=e.className.trim().split(/\s+/).slice(0,2);i=t.length>0?`button.${t.join(".")}`:"button"}else i="button";t.push({selector:i,label:s||n||"(æ— æ ‡ç­¾)",ariaLabel:o||"",text:s,score:r})}}),t.sort((t,e)=>e.score-t.score),t.slice(0,10)}}),s=e[0]?.result||[];0===s.length?this.showEmptyResultModal():this.showCandidatesModal(s)}catch(t){console.error("æ™ºèƒ½æŸ¥æ‰¾å¤±è´¥:",t);let e="æ™ºèƒ½æŸ¥æ‰¾å¤±è´¥";t instanceof Error&&(e+=": "+t.message),this.showStatus(e,"error"),this.closeModal()}}showScanningModal(){const t=document.getElementById("smart-find-modal");t&&(t.innerHTML='\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>ğŸ” æ­£åœ¨æ‰«æé¡µé¢...</h3>\n          <button class="modal-close" id="modal-close">Ã—</button>\n        </div>\n        <div class="modal-body">\n          <div class="scanning-indicator">\n            <div class="spinner"></div>\n            <p style="color: #888;">æ­£åœ¨æŸ¥æ‰¾COPYæŒ‰é’®...</p>\n          </div>\n        </div>\n      </div>\n    ',t.style.display="flex",document.getElementById("modal-close")?.addEventListener("click",()=>{this.closeModal()}))}showEmptyResultModal(){const t=document.getElementById("smart-find-modal");t&&(t.innerHTML='\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>ğŸ” æŸ¥æ‰¾ç»“æœ</h3>\n          <button class="modal-close" id="modal-close">Ã—</button>\n        </div>\n        <div class="modal-body">\n          <div class="empty-result">\n            <div class="empty-result-icon">ğŸ˜•</div>\n            <p>æœªæ‰¾åˆ°COPYæŒ‰é’®</p>\n            <p style="font-size: 12px; color: #666; margin-top: 8px;">\n              è¯·ç¡®ä¿å½“å‰é¡µé¢æœ‰AIå¯¹è¯å›ç­”ï¼Œå¹¶ä¸”æœ‰å¤åˆ¶æŒ‰é’®\n            </p>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn-cancel" id="modal-cancel">å…³é—­</button>\n        </div>\n      </div>\n    ',t.style.display="flex",document.getElementById("modal-close")?.addEventListener("click",()=>this.closeModal()),document.getElementById("modal-cancel")?.addEventListener("click",()=>this.closeModal()))}showCandidatesModal(t){const e=document.getElementById("smart-find-modal");e&&(e.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>ğŸ” æ‰¾åˆ° ${t.length} ä¸ªå€™é€‰æŒ‰é’®</h3>\n          <button class="modal-close" id="modal-close">Ã—</button>\n        </div>\n        <div class="modal-body">\n          <p style="margin-bottom: 12px; font-size: 13px; color: #888;">\n            ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªCOPYæŒ‰é’®ï¼š\n          </p>\n          ${t.map((t,e)=>`\n            <div class="button-candidate" data-index="${e}">\n              <div class="button-info">\n                <div class="button-label">${this.escapeHtml(t.label)}</div>\n                <div class="button-selector">${this.escapeHtml(t.selector)}</div>\n                <div class="button-details">\n                  ${t.ariaLabel?`aria-label: ${this.escapeHtml(t.ariaLabel)}`:""}\n                  ${t.score?` â€¢ ç›¸å…³åº¦: ${t.score}åˆ†`:""}\n                </div>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n        <div class="modal-footer">\n          <button class="btn-cancel" id="modal-cancel">å–æ¶ˆ</button>\n          <button class="btn-confirm" id="modal-confirm" disabled>ç¡®å®š</button>\n        </div>\n      </div>\n    `,e.style.display="flex",document.getElementById("modal-close")?.addEventListener("click",()=>this.closeModal()),document.getElementById("modal-cancel")?.addEventListener("click",()=>this.closeModal()),document.getElementById("modal-confirm")?.addEventListener("click",()=>this.confirmSelection()),e.querySelectorAll(".button-candidate").forEach(e=>{e.addEventListener("click",e=>{const s=parseInt(e.currentTarget.getAttribute("data-index")||"0");this.selectCandidate(s,t)})}))}selectCandidate(t,e){this.selectedCandidate=e[t];const s=document.getElementById("smart-find-modal");if(!s)return;s.querySelectorAll(".button-candidate").forEach(t=>{t.classList.remove("selected")});const n=s.querySelector(`[data-index="${t}"]`);n?.classList.add("selected");const i=document.getElementById("modal-confirm");i&&(i.disabled=!1)}confirmSelection(){this.selectedCandidate&&(this.configSelectorInput&&(this.configSelectorInput.value=this.selectedCandidate.selector),this.showStatus(`âœ… å·²é€‰æ‹©: ${this.selectedCandidate.selector}`,"success"),this.closeModal(),this.selectedCandidate=null)}closeModal(){const t=document.getElementById("smart-find-modal");t&&(t.style.display="none",t.innerHTML=""),this.selectedCandidate=null}addUrl(){const t=this.newUrlInput?.value.trim();t?/^[\w\-.*]+(\.\w{2,})?$/.test(t)||"localhost"===t?this.currentSettings.enabledUrls.includes(t)?this.showStatus("è¯¥ç½‘ç«™å·²å­˜åœ¨","error"):(this.currentSettings.enabledUrls.push(t),this.renderUrlList(),this.newUrlInput&&(this.newUrlInput.value=""),this.showStatus("âœ… å·²æ·»åŠ ï¼Œè¯·ç‚¹å‡»ä¿å­˜è®¾ç½®","success")):this.showStatus("è¯·è¾“å…¥æœ‰æ•ˆçš„åŸŸåæ ¼å¼","error"):this.showStatus("è¯·è¾“å…¥ç½‘ç«™åŸŸå","error")}removeUrl(t){this.currentSettings.enabledUrls.splice(t,1),this.renderUrlList(),this.showStatus("âœ… å·²åˆ é™¤ï¼Œè¯·ç‚¹å‡»ä¿å­˜è®¾ç½®","success")}addConfig(){const t=this.configHostnameInput?.value.trim(),e=this.configSelectorInput?.value.trim(),s=this.configContainerInput?.value.trim();if(!t||!e)return void this.showStatus("è¯·è¾“å…¥åŸŸåå’ŒCOPYæŒ‰é’®é€‰æ‹©å™¨","error");if(this.currentSettings.siteConfigs.some(e=>e.hostname===t))return void this.showStatus("è¯¥ç½‘ç«™é…ç½®å·²å­˜åœ¨ï¼Œè¯·å…ˆåˆ é™¤","error");const n={hostname:t,copyButtonSelector:e,responseContainerSelector:s||void 0};this.currentSettings.siteConfigs.push(n),this.renderConfigList(),this.configHostnameInput&&(this.configHostnameInput.value=""),this.configSelectorInput&&(this.configSelectorInput.value=""),this.configContainerInput&&(this.configContainerInput.value=""),this.showStatus("âœ… å·²æ·»åŠ é…ç½®ï¼Œè¯·ç‚¹å‡»ä¿å­˜è®¾ç½®","success")}removeConfig(t){this.currentSettings.siteConfigs.splice(t,1),this.renderConfigList(),this.showStatus("âœ… å·²åˆ é™¤ï¼Œè¯·ç‚¹å‡»ä¿å­˜è®¾ç½®","success")}async saveSettings(){const t=document.getElementById("save-settings");if(t)try{this.currentSettings.savePath=this.savePathInput?.value.trim()||"";const e=this.currentSettings.promptFiles||[];await chrome.storage.local.set({promptFiles:e});const s={...this.currentSettings,promptFiles:void 0};delete s.promptFiles;const n=JSON.stringify(s),i=new Blob([n]).size;console.log(`ä¿å­˜é…ç½®åˆ° syncï¼Œå¤§å°: ${i} å­—èŠ‚ (${(i/1024).toFixed(2)} KB)`),i>8192&&console.warn("é…ç½®å¤§å°è¶…è¿‡ 8KBï¼Œå¯èƒ½è¶…å‡º chrome.storage.sync å•é¡¹é™åˆ¶");const o={};if(e.length>0){let t=0;e.forEach((e,s)=>{const n=new Blob([e.path]).size;t+=n,o[`promptFiles[${s}].path`]=n}),o["promptFiles.total"]=t}o.enabledUrls=new Blob([JSON.stringify(this.currentSettings.enabledUrls)]).size,o.siteConfigs=new Blob([JSON.stringify(this.currentSettings.siteConfigs)]).size,o.other=i-(o["promptFiles.total"]||0)-o.enabledUrls-o.siteConfigs,console.log("é…ç½®å¤§å°åˆ†æ:",o),await new Promise((t,e)=>{chrome.storage.sync.set({settings:s},()=>{const s=chrome.runtime.lastError;s?(console.error("chrome.storage.sync.set error:",s),e(s)):t()})}),t.textContent="ğŸ’¾ ä¿å­˜è®¾ç½®",t.className="primary",t.disabled=!1,this.showStatus("âœ… è®¾ç½®å·²ä¿å­˜","success"),await chrome.storage.local.remove("draftSettings")}catch(e){console.error("ä¿å­˜è®¾ç½®å¤±è´¥:",e);let s="æœªçŸ¥é”™è¯¯";s=e instanceof Error?e.message:e&&"object"==typeof e?"message"in e&&"string"==typeof e.message?e.message:JSON.stringify(e):String(e),this.showStatus(`âŒ ä¿å­˜å¤±è´¥: ${s}`,"error"),t.textContent="ğŸ’¾ ä¿å­˜è®¾ç½®",t.className="primary"}}async resetToDefaults(){confirm("ç¡®å®šè¦æ¢å¤é»˜è®¤è®¾ç½®å—ï¼Ÿæ‰€æœ‰è‡ªå®šä¹‰é…ç½®å°†è¢«æ¸…é™¤ã€‚")&&(this.currentSettings={port:8765,enabledUrls:[...t],showOnAllSites:!1,siteConfigs:[],promptFiles:[]},this.portInput&&(this.portInput.value="8765"),this.showOnAllSitesCheckbox&&(this.showOnAllSitesCheckbox.checked=!1),this.renderUrlList(),this.renderConfigList(),this.renderPromptList(),this.showStatus("âœ… å·²æ¢å¤é»˜è®¤è®¾ç½®ï¼Œè¯·ç‚¹å‡»ä¿å­˜","success"))}async exportConfig(){try{const t=await chrome.storage.sync.get(null),e={version:"1.0.0",timestamp:(new Date).toISOString(),extension:"AI to VSCode Bridge",data:t},s=JSON.stringify(e,null,2),n=new Blob([s],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=`ai-vscode-bridge-config-${Date.now()}.json`,o.click(),URL.revokeObjectURL(i),this.showStatus("âœ… é…ç½®å·²å¯¼å‡º","success")}catch(t){console.error("å¯¼å‡ºå¤±è´¥:",t),this.showStatus("âŒ å¯¼å‡ºå¤±è´¥: "+t.message,"error")}}async handleImportFile(t){const e=t.target,s=e.files?.[0];if(s)try{const t=await s.text(),e=JSON.parse(t);if(!e.data||!e.version)return void this.showStatus("âŒ æ— æ•ˆçš„é…ç½®æ–‡ä»¶æ ¼å¼","error");if(!confirm("ç¡®å®šè¦å¯¼å…¥é…ç½®å—ï¼Ÿå½“å‰é…ç½®å°†è¢«è¦†ç›–ã€‚"))return;await chrome.storage.sync.set(e.data),await this.loadSettings(),this.showStatus("âœ… é…ç½®å·²å¯¼å…¥ï¼Œè¯·åˆ·æ–°ç½‘é¡µä½¿é…ç½®ç”Ÿæ•ˆ","success")}catch(t){console.error("å¯¼å…¥å¤±è´¥:",t),this.showStatus("âŒ å¯¼å…¥å¤±è´¥: "+t.message,"error")}finally{e.value=""}}showStatus(t,e){this.statusDiv&&(this.statusDiv.textContent=t,this.statusDiv.className=e,this.statusDiv.style.display="block",setTimeout(()=>{this.statusDiv&&(this.statusDiv.style.display="none")},4e3))}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}renderPromptList(){if(!this.promptList)return;const t=this.currentSettings.promptFiles||[];0!==t.length?(this.promptList.innerHTML=t.map((t,e)=>`\n      <div class="url-item">\n        <div style="flex: 1;">\n          <div style="font-weight: 500; color: #fff;">ğŸ“ ${this.escapeHtml(t.name)}</div>\n          <div style="font-size: 11px; color: #888; margin-top: 2px;">\n            å†…å®¹é•¿åº¦: ${t.path.length} å­—ç¬¦\n          </div>\n        </div>\n        <div style="display: flex; gap: 6px;">\n          <button \n            class="action-btn rename-btn" \n            data-index="${e}"\n            style="\n              padding: 4px 10px;\n              background: #4a4a4a;\n              color: white;\n              border: none;\n              border-radius: 3px;\n              cursor: pointer;\n              font-size: 12px;\n            "\n          >\n            âœï¸ é‡å‘½å\n          </button>\n          <button \n            class="danger" \n            data-index="${e}"\n          >\n            åˆ é™¤\n          </button>\n        </div>\n      </div>\n    `).join(""),this.promptList.querySelectorAll(".danger").forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.getAttribute("data-index")||"0");this.removePrompt(e)})}),this.promptList.querySelectorAll(".rename-btn").forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.getAttribute("data-index")||"0");this.renamePrompt(e)})})):this.promptList.innerHTML='<div class="empty-state">æš‚æ— æç¤ºè¯é…ç½®</div>'}async handleFileSelect(t){const e=t.target,s=e.files?.[0];if(s)try{this.currentFileContent=await s.text(),this.currentFileName=s.name.replace(/\.(md|markdown|txt)$/i,""),this.fileNameDisplay&&(this.fileNameDisplay.textContent=s.name,this.fileNameDisplay.style.color="#fff"),this.showStatus(`âœ… å·²åŠ è½½: ${s.name} (${this.currentFileContent.length} å­—ç¬¦)`,"success")}catch(t){console.error("è¯»å–æ–‡ä»¶å¤±è´¥:",t),this.showStatus("âŒ è¯»å–æ–‡ä»¶å¤±è´¥","error")}}addPrompt(){if(!this.currentFileContent||0===this.currentFileContent.trim().length){this.showStatus("âŒ è¯·å…ˆé€‰æ‹©æ–‡ä»¶","error");const t=document.getElementById("file-selector-wrapper");return void(t&&(t.style.borderColor="#ff4444",setTimeout(()=>{t&&(t.style.borderColor="#3e3e3e")},2e3)))}if(this.currentSettings.promptFiles||(this.currentSettings.promptFiles=[]),this.currentSettings.promptFiles.some(t=>t.name===this.currentFileName))return void this.showStatus(`âŒ æç¤ºè¯ "${this.currentFileName}" å·²å­˜åœ¨`,"error");const t={id:Date.now().toString(),name:this.currentFileName,path:this.currentFileContent,enabled:!0};this.currentSettings.promptFiles.push(t),this.renderPromptList(),this.fileNameDisplay&&(this.fileNameDisplay.textContent="æœªé€‰æ‹©æ–‡ä»¶",this.fileNameDisplay.style.color="#888"),this.currentFileContent="",this.currentFileName="",this.promptFileInput&&(this.promptFileInput.value=""),this.saveDraft(),this.showStatus(`âœ… å·²æ·»åŠ æç¤ºè¯ï¼š${t.name}`,"success")}renamePrompt(t){if(!this.currentSettings.promptFiles)return;const e=this.currentSettings.promptFiles[t];if(!e)return;const s=this.promptList?.querySelectorAll(".url-item");if(!s||!s[t])return;const n=s[t].querySelector("div > div:first-child");if(!n)return;const i=e.name,o=n.innerHTML,r=document.createElement("input");r.type="text",r.value=i,r.style.cssText="\n    width: 100%;\n    padding: 4px 8px;\n    background: #2d2d2d;\n    border: 1px solid #007bff;\n    border-radius: 3px;\n    color: #fff;\n    font-size: 14px;\n    font-weight: 500;\n  ",n.innerHTML="",n.appendChild(r),r.focus(),r.select();const l=()=>{const s=r.value.trim();return s?this.currentSettings.promptFiles.some((e,n)=>n!==t&&e.name===s)?(n.innerHTML=o,void this.showStatus(`âŒ æç¤ºè¯ "${s}" å·²å­˜åœ¨`,"error")):(e.name=s,n.innerHTML=`ğŸ“ ${this.escapeHtml(s)}`,this.saveDraft(),void this.showStatus(`âœ… å·²é‡å‘½åä¸ºï¼š${s}`,"success")):(n.innerHTML=o,void this.showStatus("âŒ åç§°ä¸èƒ½ä¸ºç©º","error"))};r.addEventListener("keydown",t=>{"Enter"===t.key?(t.preventDefault(),l()):"Escape"===t.key&&(t.preventDefault(),n.innerHTML=o)}),r.addEventListener("blur",l)}removePrompt(t){this.currentSettings.promptFiles&&(this.currentSettings.promptFiles.splice(t,1),this.renderPromptList(),this.saveDraft(),this.showStatus("âœ… å·²åˆ é™¤ï¼Œè¯·ç‚¹å‡»ä¿å­˜è®¾ç½®","success"))}}document.addEventListener("DOMContentLoaded",()=>{new e})})();
//# sourceMappingURL=popup.js.map