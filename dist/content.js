(()=>{"use strict";class t{static findLatestCopyButton(){const t=window.location.hostname;console.log("ğŸ” æŸ¥æ‰¾COPYæŒ‰é’®ï¼Œå½“å‰åŸŸå:",t);const e=this.DEFAULT_SELECTORS.find(e=>t.includes(e.hostname));if(e){console.log("âœ… æ‰¾åˆ°é»˜è®¤é…ç½®:",e.name);const t=this.findButtonWithConfig(e);if(t)return console.log("âœ… ä½¿ç”¨é»˜è®¤é…ç½®æ‰¾åˆ°æŒ‰é’®"),t}return console.log("ä½¿ç”¨é€šç”¨ç­–ç•¥æŸ¥æ‰¾..."),this.findButtonGeneric()}static async loadConfigs(){}static findButtonWithConfig(t){const e=t.copyButtonSelector;if(console.log("å°è¯•é€‰æ‹©å™¨:",e),window.location.hostname.includes("aistudio.google.com"))return this.findAIStudioCopyButton();if(window.location.hostname.includes("claude.ai"))return this.findClaudeCopyButton();if(t.responseContainerSelector){const o=document.querySelectorAll(t.responseContainerSelector);if(console.log("æ‰¾åˆ°",o.length,"ä¸ªå›ç­”å®¹å™¨"),o.length>0){const t=o[o.length-1].querySelector(e);if(t)return console.log("âœ… åœ¨å®¹å™¨ä¸­æ‰¾åˆ°æŒ‰é’®"),t}}const o=document.querySelectorAll(e);return console.log("å…¨å±€æ‰¾åˆ°",o.length,"ä¸ªåŒ¹é…æŒ‰é’®"),o.length>0?(console.log("âœ… è¿”å›æœ€åä¸€ä¸ªæŒ‰é’®"),o[o.length-1]):null}static findClaudeCopyButton(){console.log("ğŸ” ä½¿ç”¨ Claude ä¸“ç”¨æŸ¥æ‰¾é€»è¾‘");const t=Array.from(document.querySelectorAll('button[data-testid="action-bar-copy"]'));if(t.length>0)return console.log(`âœ… æ‰¾åˆ° ${t.length} ä¸ª Claude å¤åˆ¶æŒ‰é’®`),t[t.length-1];const e=Array.from(document.querySelectorAll("button"));for(let t=e.length-1;t>=0;t--){const o=e[t],n=o.querySelector("svg");if(n){const t=n.querySelector("path");if(t){const e=t.getAttribute("d")||"";if(e.includes("M10 1.5C11.1097")||e.includes("clipboard"))return console.log("âœ… é€šè¿‡ SVG è·¯å¾„æ‰¾åˆ° Claude å¤åˆ¶æŒ‰é’®"),o}}}return console.log("âŒ æœªæ‰¾åˆ° Claude å¤åˆ¶æŒ‰é’®"),null}static findAIStudioCopyButton(){console.log("ğŸ” ä½¿ç”¨ AI Studio ä¸“ç”¨æŸ¥æ‰¾é€»è¾‘");const t=document.querySelector('button[mat-menu-item][jslog^="282205"]');if(t)return console.log('âœ… é€šè¿‡ jslog="282205" æ‰¾åˆ°æŒ‰é’®'),t;const e=document.querySelector(".copy-markdown-button");if(e){const t=e.closest("button[mat-menu-item]");if(t)return console.log("âœ… é€šè¿‡ .copy-markdown-button class æ‰¾åˆ°æŒ‰é’®"),t}const o=Array.from(document.querySelectorAll("button[mat-menu-item]"));for(const t of o){const e=t.textContent?.trim()||"";if("Copy as markdown"===e||e.toLowerCase().includes("copy as markdown"))return console.log('âœ… é€šè¿‡æ–‡æœ¬ "Copy as markdown" æ‰¾åˆ°æŒ‰é’®'),t}for(const t of o){const e=t.textContent?.toLowerCase()||"";if(e.includes("markdown")&&e.includes("copy"))return console.log("âœ… æ‰¾åˆ°åŒ…å« markdown å’Œ copy çš„æŒ‰é’®:",e),t}for(const t of o){const e=t.textContent?.toLowerCase()||"";if(e.includes("copy"))return console.log("âœ… æ‰¾åˆ°åŒ…å« copy çš„æŒ‰é’®:",e),t}console.log("âš ï¸ èœå•å¯èƒ½æœªå±•å¼€ï¼Œå°è¯•æŸ¥æ‰¾èœå•æŒ‰é’®");const n=Array.from(document.querySelectorAll('button[aria-label*="options"], button[iconname="more_vert"]'));return n.length>0?(console.log("âœ… æ‰¾åˆ°",n.length,"ä¸ªèœå•è§¦å‘æŒ‰é’®"),n[n.length-1]):(console.log("âŒ æœªæ‰¾åˆ°æŒ‰é’®"),null)}static findButtonGeneric(){console.log("ğŸ” ä½¿ç”¨é€šç”¨ç­–ç•¥...");const t=['button[data-testid*="copy"]','button[aria-label*="Copy" i]','button[aria-label*="å¤åˆ¶" i]','button[title*="Copy" i]',"button.copy-button","button.copy-btn",'[data-testid*="copy"]'];for(const e of t)try{const t=document.querySelectorAll(e);if(t.length>0)return console.log(`âœ… é€šç”¨é€‰æ‹©å™¨ "${e}" æ‰¾åˆ° ${t.length} ä¸ªæŒ‰é’®`),t[t.length-1]}catch(t){continue}return console.error("âŒ æ‰€æœ‰ç­–ç•¥éƒ½å¤±è´¥äº†"),null}static async getClipboardContent(){try{return await navigator.clipboard.readText()}catch(t){throw new Error("æ— æ³•è¯»å–å‰ªè´´æ¿")}}static makeDraggable(t){let e,o,n,s,i=!1;const a=t.querySelector(".panel-header");a&&(a.style.cursor="move",a.addEventListener("mousedown",e=>{e.target.classList.contains("close-btn")||(i=!0,n=e.clientX-t.offsetLeft,s=e.clientY-t.offsetTop)}),document.addEventListener("mousemove",a=>{i&&(a.preventDefault(),e=a.clientX-n,o=a.clientY-s,t.style.left=`${e}px`,t.style.top=`${o}px`,t.style.right="auto",t.style.bottom="auto")}),document.addEventListener("mouseup",()=>{i=!1}))}}t.DEFAULT_SELECTORS=[{hostname:"chat.openai.com",copyButtonSelector:'button[aria-label*="Copy"]',responseContainerSelector:'[data-message-author-role="assistant"]',name:"ChatGPT"},{hostname:"claude.ai",copyButtonSelector:'button[data-testid="action-bar-copy"]',responseContainerSelector:void 0,name:"Claude"},{hostname:"gemini.google.com",copyButtonSelector:'button[aria-label="Copy"]',responseContainerSelector:".model-response",name:"Gemini"},{hostname:"perplexity.ai",copyButtonSelector:'button[aria-label="Copy"]',responseContainerSelector:void 0,name:"Perplexity"},{hostname:"aistudio.google.com",copyButtonSelector:'button[mat-menu-item][jslog^="282205"]',responseContainerSelector:void 0,name:"AI Studio"}],new class{constructor(){this.panel=null,this.statusElement=null,this.enabled=!1,this.dailyCounter=1,this.initialize()}async initialize(){await this.checkAndInitialize(),await this.loadDailyCounter(),this.queryConnectionStatus()}queryConnectionStatus(){chrome.runtime.sendMessage({action:"getConnectionStatus"},t=>{chrome.runtime.lastError?console.error("æŸ¥è¯¢è¿æ¥çŠ¶æ€å¤±è´¥:",chrome.runtime.lastError):t&&void 0!==t.connected&&(console.log("å½“å‰è¿æ¥çŠ¶æ€:",t.connected?"å·²è¿æ¥":"æœªè¿æ¥"),this.updateConnectionStatus(t.connected))})}async loadDailyCounter(){const t=(new Date).toDateString(),e=await chrome.storage.local.get(["lastSaveDate","dailyCounter"]);e.lastSaveDate===t?this.dailyCounter=(e.dailyCounter||0)+1:this.dailyCounter=1}async updateDailyCounter(){const t=(new Date).toDateString();await chrome.storage.local.set({lastSaveDate:t,dailyCounter:this.dailyCounter}),this.dailyCounter++}async checkAndInitialize(){const t=await chrome.storage.sync.get({enabledUrls:["chat.openai.com","claude.ai","gemini.google.com","perplexity.ai"],showOnAllSites:!1}),e=window.location.hostname,o=t.showOnAllSites,n=t.enabledUrls;o||this.isUrlEnabled(e,n)?(this.enabled=!0,this.createPanel(),this.setupMessageListener(),console.log("âœ… æ‚¬æµ®çª—å·²å¯ç”¨")):console.log("å½“å‰ç½‘ç«™æœªå¯ç”¨æ‚¬æµ®çª—:",e),chrome.storage.onChanged.addListener(t=>{(t.enabledUrls||t.showOnAllSites||t.siteConfigs)&&window.location.reload()})}isUrlEnabled(t,e){return e.some(e=>{if(e.includes("*")){const o=e.replace(/\*/g,".*");return new RegExp(o).test(t)}return t.includes(e)})}createPanel(){this.panel=document.createElement("div"),this.panel.id="ai-vscode-panel",this.panel.innerHTML='\n    <div class="panel-container">\n      <div class="panel-header">\n        <span>å‘é€åˆ°VS Code</span>\n        <button class="close-btn" id="close-panel">Ã—</button>\n      </div>\n      <div class="filename-preview" id="filename-preview" style="\n        font-size: 11px;\n        color: #888;\n        padding: 6px 8px;\n        background: #2d2d2d;\n        border-radius: 4px;\n        margin-bottom: 8px;\n        word-break: break-all;\n        display: none;\n      ">\n        æ–‡ä»¶åé¢„è§ˆ...\n      </div>\n      <button id="send-to-vscode">å¤åˆ¶å¹¶ä¿å­˜</button>\n      <div class="status" id="connection-status">\n        <span class="status-dot"></span>\n        <span class="status-text">æœªè¿æ¥</span>\n      </div>\n    </div>\n  ',document.body.appendChild(this.panel),t.makeDraggable(this.panel);const e=document.getElementById("send-to-vscode");e?.addEventListener("click",()=>this.handleSendClick());const o=document.getElementById("close-panel");o?.addEventListener("click",()=>this.togglePanel()),this.statusElement=document.getElementById("connection-status")}togglePanel(){this.panel&&(this.panel.style.display="none"===this.panel.style.display?"block":"none")}async handleSendClick(){try{if(console.log("ğŸš€ å¼€å§‹å‘é€æµç¨‹..."),window.location.hostname.includes("aistudio.google.com"))return void await this.handleAIStudioCopy();const e=t.findLatestCopyButton();if(!e)return console.error("âŒ æœªæ‰¾åˆ°COPYæŒ‰é’®"),void this.showError("æœªæ‰¾åˆ°COPYæŒ‰é’®ï¼Œè¯·åœ¨è®¾ç½®ä¸­é…ç½®é€‰æ‹©å™¨");console.log("âœ… æ‰¾åˆ°æŒ‰é’®ï¼Œå‡†å¤‡ç‚¹å‡»"),e.click(),await this.delay(300);const o=await t.getClipboardContent();if(!o||0===o.trim().length)return void this.showError("å‰ªè´´æ¿å†…å®¹ä¸ºç©º");console.log("âœ… è¯»å–åˆ°å†…å®¹ï¼Œé•¿åº¦:",o.length);const n=this.generateSmartFilename(o);console.log("ğŸ“ ç”Ÿæˆæ–‡ä»¶å:",n),this.showFilenamePreview(n),this.sendToVSCode(o,n),await this.updateDailyCounter()}catch(t){const e=t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯";console.error("å‘é€å¤±è´¥:",t),this.showError(`æ“ä½œå¤±è´¥ï¼š${e}`)}}async handleAIStudioCopy(){try{console.log("ğŸ” AI Studio ç‰¹æ®Šå¤„ç†ï¼šæŸ¥æ‰¾èœå•æŒ‰é’®");const e=Array.from(document.querySelectorAll('button[aria-label*="options"], button[iconname="more_vert"], button[aria-label*="Open options"], ms-chat-turn-options button'));if(0===e.length)return void this.showError("æœªæ‰¾åˆ°èœå•æŒ‰é’®");const o=e[e.length-1];console.log("âœ… æ‰¾åˆ°èœå•æŒ‰é’®ï¼Œå‡†å¤‡ç‚¹å‡»"),o.click(),console.log("âœ… èœå•å·²å±•å¼€ï¼Œç­‰å¾…åŠ è½½..."),await this.delay(500);const n=t.findLatestCopyButton();if(!n)return console.error("âŒ èœå•å±•å¼€åä»æœªæ‰¾åˆ°å¤åˆ¶æŒ‰é’®"),this.showError("æœªæ‰¾åˆ°å¤åˆ¶æŒ‰é’®"),void o.click();console.log("âœ… æ‰¾åˆ°å¤åˆ¶æŒ‰é’®ï¼Œå‡†å¤‡ç‚¹å‡»"),n.click(),await this.delay(300);const s=await t.getClipboardContent();if(!s||0===s.trim().length)return void this.showError("å‰ªè´´æ¿å†…å®¹ä¸ºç©º");console.log("âœ… è¯»å–åˆ°å†…å®¹ï¼Œé•¿åº¦:",s.length);const i=this.generateSmartFilename(s);console.log("ğŸ“ ç”Ÿæˆæ–‡ä»¶å:",i),this.showFilenamePreview(i),this.sendToVSCode(s,i),await this.updateDailyCounter()}catch(t){const e=t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯";console.error("AI Studio å¤åˆ¶å¤±è´¥:",t),this.showError(`æ“ä½œå¤±è´¥ï¼š${e}`)}}generateSmartFilename(t){const e=new Date,o=e.getFullYear()+String(e.getMonth()+1).padStart(2,"0")+String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0")+String(e.getMinutes()).padStart(2,"0")+String(e.getSeconds()).padStart(2,"0"),s=String(this.dailyCounter).padStart(3,"0"),i=this.extractFirstSentence(t),a=this.cleanSentence(i);return`${o}-${n}-${s}-${this.truncateFilename(a,50)}.md`}extractFirstSentence(t){let e=t.trim();e=e.replace(/^#+\s+/gm,""),e=e.replace(/\*\*(.+?)\*\*/g,"$1"),e=e.replace(/\*(.+?)\*/g,"$1"),e=e.replace(/`(.+?)`/g,"$1"),e=e.replace(/\[(.+?)\]\(.+?\)/g,"$1");const o=e.split(/[ã€‚.!?ï¼ï¼Ÿ\n]/);for(const t of o){const e=t.trim();if(e.length>5)return e}return e.substring(0,50).trim()}cleanSentence(t){const e=[/^å¥½çš„[ï¼!ï¼Œ,ã€‚.\s]*/i,/^å½“ç„¶[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æˆ‘ä¼š[^\s]{0,5}/i,/^æˆ‘å°†[^\s]{0,5}/i,/^è®©æˆ‘[^\s]{0,5}/i,/^æ˜ç™½[äº†å—]?[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æ”¶åˆ°[ï¼!ï¼Œ,ã€‚.\s]*/i,/^å¥½[çš„å•¦][ï¼!ï¼Œ,ã€‚.\s]*/i,/^OK[ï¼!ï¼Œ,ã€‚.\s]*/i,/^äº†è§£[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æ²¡é—®é¢˜[ï¼!ï¼Œ,ã€‚.\s]*/i];let o=t;for(const t of e)o=o.replace(t,"");return o=o.replace(/[<>:"/\\|?*\x00-\x1F]/g,""),o=o.replace(/\s+/g,"-"),o=o.replace(/^-+|-+$/g,""),o}truncateFilename(t,e){if(t.length<=e)return t;let o=t.substring(0,e);const n=o.lastIndexOf("-");return n>.7*e&&(o=o.substring(0,n)),o}showFilenamePreview(t){const e=document.getElementById("filename-preview");e&&(e.textContent=`ğŸ“„ ${t}`,e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3))}sendToVSCode(t,e){const o={action:"sendToVSCode",content:t,filename:e};console.log("ğŸ“¤ å‘é€åˆ°VS Code:",e);const n=setTimeout(()=>{this.showError("å‘é€è¶…æ—¶ï¼Œè¯·æ£€æŸ¥VS Codeæ˜¯å¦å·²å¯åŠ¨WebSocketæœåŠ¡")},5e3);chrome.runtime.sendMessage(o,t=>{if(clearTimeout(n),chrome.runtime.lastError)return console.error("æ‰©å±•é€šä¿¡å¤±è´¥:",chrome.runtime.lastError),void this.showError("æ‰©å±•é€šä¿¡å¤±è´¥ï¼Œè¯·é‡æ–°åŠ è½½é¡µé¢");if(t&&t.success)this.showSuccess(`âœ… å·²ä¿å­˜: ${e}`);else{const e=t?.error||"æœªçŸ¥é”™è¯¯";this.showError(`å‘é€å¤±è´¥ï¼š${e}`)}})}setupMessageListener(){chrome.runtime.onMessage.addListener(t=>{"connectionStatus"===t.type&&this.updateConnectionStatus("connected"===t.status)})}updateConnectionStatus(t){if(!this.statusElement)return;const e=this.statusElement.querySelector(".status-text"),o=this.statusElement.querySelector(".status-dot");t?(this.statusElement.classList.add("connected"),e&&(e.textContent="å·²è¿æ¥"),o&&o.classList.add("active")):(this.statusElement.classList.remove("connected"),e&&(e.textContent="æœªè¿æ¥"),o&&o.classList.remove("active"))}showSuccess(t){this.showNotification(t,"success")}showError(t){this.showNotification(t,"error")}showNotification(t,e){const o=document.createElement("div");o.className=`notification ${e}`,o.textContent=t,document.body.appendChild(o),setTimeout(()=>o.remove(),3e3)}delay(t){return new Promise(e=>setTimeout(e,t))}}})();
//# sourceMappingURL=content.js.map