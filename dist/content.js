(()=>{"use strict";class e{static findLatestCopyButton(){const e=performance.now();console.group("ğŸ” [æ€§èƒ½ç›‘æ§] æŸ¥æ‰¾COPYæŒ‰é’®");const t=window.location.hostname;console.log("ğŸ“ å½“å‰åŸŸå:",t),console.log("â±ï¸ å¼€å§‹æ—¶é—´:",(new Date).toLocaleTimeString());let o=null;try{if(t.includes("perplexity.ai"))console.log("ğŸ¯ ä½¿ç”¨ Perplexity ä¸“ç”¨æŸ¥æ‰¾"),o=this.findPerplexityCopyButton();else{const e=this.DEFAULT_SELECTORS.find(e=>t.includes(e.hostname));e?(console.log("âœ… æ‰¾åˆ°é»˜è®¤é…ç½®:",e.name),o=this.findButtonWithConfig(e)):(console.log("âš ï¸ ä½¿ç”¨é€šç”¨ç­–ç•¥æŸ¥æ‰¾"),o=this.findButtonGeneric())}}catch(e){console.error("âŒ æŸ¥æ‰¾æŒ‰é’®æ—¶å‘ç”Ÿé”™è¯¯:",e)}const n=(performance.now()-e).toFixed(2);return console.log("â±ï¸ æŸ¥æ‰¾è€—æ—¶:",n,"ms"),console.log("ğŸ“Š ç»“æœ:",o?"âœ… æ‰¾åˆ°æŒ‰é’®":"âŒ æœªæ‰¾åˆ°æŒ‰é’®"),console.log("ğŸ’¾ å½“å‰å†…å­˜ä½¿ç”¨:",this.getMemoryUsage()),console.groupEnd(),o}static async loadConfigs(){}static findPerplexityCopyButton(){const e=performance.now();console.group("ğŸ” [Perplexity] ä¸“ç”¨æŸ¥æ‰¾");try{console.time("æŸ¥æ‰¾å›å¤å®¹å™¨");const t=document.querySelectorAll("div.py-md.md\\:pb-headerHeight.mx-auto.max-w-threadContentWidth > div");if(console.timeEnd("æŸ¥æ‰¾å›å¤å®¹å™¨"),console.log("ğŸ“¦ å›å¤å®¹å™¨æ•°é‡:",t.length),0===t.length)return console.warn("âŒ æœªæ‰¾åˆ°å›å¤å®¹å™¨"),console.groupEnd(),null;const o=t[t.length-1];console.log("ğŸ“ ä½¿ç”¨æœ€åä¸€ä¸ªå®¹å™¨ (ç´¢å¼•:",t.length-1,")"),console.time("æŸ¥æ‰¾å¤åˆ¶æŒ‰é’®");const n=o.querySelectorAll('button[aria-label*="Copy"], button[data-testid*="copy"]');if(console.timeEnd("æŸ¥æ‰¾å¤åˆ¶æŒ‰é’®"),console.log("ğŸ”˜ å¤åˆ¶æŒ‰é’®æ•°é‡:",n.length),n.length>0){const t=n[n.length-1];return console.log("âœ… é€‰ä¸­æŒ‰é’®:",{ariaLabel:t.getAttribute("aria-label"),dataTestId:t.getAttribute("data-testid"),text:t.textContent?.trim().substring(0,20)}),console.log("â±ï¸ PerplexityæŸ¥æ‰¾è€—æ—¶:",(performance.now()-e).toFixed(2),"ms"),console.groupEnd(),t}console.warn("âš ï¸ æœªæ‰¾åˆ°æ ‡å‡†å¤åˆ¶æŒ‰é’®ï¼Œå°è¯•é€’å½’æœç´¢"),console.time("é€’å½’æœç´¢æŒ‰é’®");const s=Array.from(o.querySelectorAll("button"));console.log("ğŸ” å®¹å™¨å†…æŒ‰é’®æ€»æ•°:",s.length);for(let e=0;e<s.length;e++){const t=s[e],o=t.getAttribute("aria-label")?.toLowerCase()||"",n=t.getAttribute("data-testid")?.toLowerCase()||"",l=t.textContent?.toLowerCase()||"";if(o.includes("copy")||n.includes("copy")||l.includes("copy"))return console.log("âœ… é€’å½’æ‰¾åˆ°æŒ‰é’® (ç´¢å¼•:",e,")"),console.timeEnd("é€’å½’æœç´¢æŒ‰é’®"),console.groupEnd(),t}console.timeEnd("é€’å½’æœç´¢æŒ‰é’®")}catch(e){console.error("âŒ PerplexityæŸ¥æ‰¾å‡ºé”™:",e)}return console.warn("âŒ PerplexityæŸ¥æ‰¾å¤±è´¥"),console.groupEnd(),null}static findButtonWithConfig(e){const t=performance.now();console.group("ğŸ” [é…ç½®æŸ¥æ‰¾]",e.name);const o=e.copyButtonSelector;console.log("ğŸ¯ é€‰æ‹©å™¨:",o);try{if(window.location.hostname.includes("aistudio.google.com")){const e=this.findAIStudioCopyButton();return console.log("â±ï¸ AI StudioæŸ¥æ‰¾è€—æ—¶:",(performance.now()-t).toFixed(2),"ms"),console.groupEnd(),e}if(window.location.hostname.includes("claude.ai")){const e=this.findClaudeCopyButton();return console.log("â±ï¸ ClaudeæŸ¥æ‰¾è€—æ—¶:",(performance.now()-t).toFixed(2),"ms"),console.groupEnd(),e}if(e.responseContainerSelector){console.log("ğŸ“¦ ä½¿ç”¨å®¹å™¨é€‰æ‹©å™¨:",e.responseContainerSelector),console.time("æŸ¥æ‰¾å®¹å™¨");const t=document.querySelectorAll(e.responseContainerSelector);if(console.timeEnd("æŸ¥æ‰¾å®¹å™¨"),console.log("ğŸ“¦ å®¹å™¨æ•°é‡:",t.length),t.length>0){const e=t[t.length-1];console.time("å®¹å™¨å†…æŸ¥æ‰¾æŒ‰é’®");const n=e.querySelector(o);if(console.timeEnd("å®¹å™¨å†…æŸ¥æ‰¾æŒ‰é’®"),n)return console.log("âœ… åœ¨å®¹å™¨ä¸­æ‰¾åˆ°æŒ‰é’®"),console.groupEnd(),n}}console.warn("âš ï¸ å›é€€åˆ°å…¨å±€æŸ¥æ‰¾"),console.time("å…¨å±€æŸ¥æ‰¾æŒ‰é’®");const n=document.querySelectorAll(o);if(console.timeEnd("å…¨å±€æŸ¥æ‰¾æŒ‰é’®"),console.log("ğŸ”˜ å…¨å±€æ‰¾åˆ°æŒ‰é’®æ•°:",n.length),n.length>0)return console.log("âœ… è¿”å›æœ€åä¸€ä¸ªæŒ‰é’®"),console.groupEnd(),n[n.length-1]}catch(e){console.error("âŒ é…ç½®æŸ¥æ‰¾å‡ºé”™:",e)}return console.warn("âŒ æœªæ‰¾åˆ°æŒ‰é’®"),console.log("â±ï¸ æ€»è€—æ—¶:",(performance.now()-t).toFixed(2),"ms"),console.groupEnd(),null}static findClaudeCopyButton(){console.group("ğŸ” [Claude] ä¸“ç”¨æŸ¥æ‰¾");try{console.time("æŸ¥æ‰¾ClaudeæŒ‰é’®");const e=Array.from(document.querySelectorAll('button[data-testid="action-bar-copy"]'));if(console.timeEnd("æŸ¥æ‰¾ClaudeæŒ‰é’®"),console.log("ğŸ”˜ æ‰¾åˆ°æŒ‰é’®æ•°:",e.length),e.length>0)return console.groupEnd(),e[e.length-1];console.warn("âš ï¸ ä½¿ç”¨SVGå¤‡ç”¨æŸ¥æ‰¾"),console.time("SVGè·¯å¾„æŸ¥æ‰¾");const t=Array.from(document.querySelectorAll("button"));console.log("ğŸ” é¡µé¢æŒ‰é’®æ€»æ•°:",t.length),t.length>1e3&&console.error("âŒ æŒ‰é’®æ•°é‡å¼‚å¸¸ (>1000)ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼");for(let e=t.length-1;e>=0;e--){const o=t[e],n=o.querySelector("svg");if(n){const t=n.querySelector("path");if(t){const n=t.getAttribute("d")||"";if(n.includes("M10 1.5C11.1097")||n.includes("clipboard"))return console.log("âœ… é€šè¿‡SVGæ‰¾åˆ° (ç´¢å¼•:",e,")"),console.timeEnd("SVGè·¯å¾„æŸ¥æ‰¾"),console.groupEnd(),o}}}console.timeEnd("SVGè·¯å¾„æŸ¥æ‰¾")}catch(e){console.error("âŒ ClaudeæŸ¥æ‰¾å‡ºé”™:",e)}return console.groupEnd(),null}static findAIStudioCopyButton(){console.group("ğŸ” [AI Studio] ä¸“ç”¨æŸ¥æ‰¾");try{const e=[{name:"jslogå±æ€§",fn:()=>document.querySelector('button[mat-menu-item][jslog^="282205"]')},{name:"copy-markdown-buttonç±»",fn:()=>{const e=document.querySelector(".copy-markdown-button");return e?.closest("button[mat-menu-item]")}},{name:"Copy as markdownæ–‡æœ¬",fn:()=>Array.from(document.querySelectorAll("button[mat-menu-item]")).find(e=>e.textContent?.toLowerCase().includes("copy as markdown"))||null}];for(const t of e){console.time(t.name);const e=t.fn();if(console.timeEnd(t.name),e)return console.log("âœ… ç­–ç•¥æˆåŠŸ:",t.name),console.groupEnd(),e}}catch(e){console.error("âŒ AI StudioæŸ¥æ‰¾å‡ºé”™:",e)}return console.groupEnd(),null}static findButtonGeneric(){console.group("ğŸ” [é€šç”¨ç­–ç•¥] æŸ¥æ‰¾");const e=['button[data-testid*="copy"]','button[aria-label*="Copy" i]','button[aria-label*="å¤åˆ¶" i]','button[title*="Copy" i]',"button.copy-button","button.copy-btn",'[data-testid*="copy"]'];for(const t of e)try{console.time(`é€‰æ‹©å™¨: ${t}`);const e=document.querySelectorAll(t);if(console.timeEnd(`é€‰æ‹©å™¨: ${t}`),console.log(`  ğŸ“Š æ‰¾åˆ° ${e.length} ä¸ªæŒ‰é’®`),e.length>100&&console.warn(`  âš ï¸ æŒ‰é’®æ•°é‡è¿‡å¤š (${e.length})ï¼Œå¯èƒ½å½±å“æ€§èƒ½ï¼`),e.length>0)return console.log("  âœ… è¿”å›æœ€åä¸€ä¸ªæŒ‰é’®"),console.groupEnd(),e[e.length-1]}catch(e){console.error("  âŒ é€‰æ‹©å™¨é”™è¯¯:",e);continue}return console.error("âŒ æ‰€æœ‰é€šç”¨ç­–ç•¥éƒ½å¤±è´¥äº†"),console.groupEnd(),null}static async getClipboardContent(){const e=performance.now();console.group("ğŸ“‹ [å‰ªè´´æ¿] è¯»å–å†…å®¹");try{const t=await navigator.clipboard.readText(),o=(performance.now()-e).toFixed(2);return console.log("âœ… è¯»å–æˆåŠŸ"),console.log("ğŸ“ å†…å®¹é•¿åº¦:",t.length,"å­—ç¬¦"),console.log("â±ï¸ è¯»å–è€—æ—¶:",o,"ms"),t.length>5e4&&console.warn("âš ï¸ å†…å®¹è¿‡å¤§ (>50KB)ï¼Œå¯èƒ½å½±å“æ€§èƒ½ï¼"),console.groupEnd(),t}catch(e){throw console.error("âŒ è¯»å–å¤±è´¥:",e),console.groupEnd(),new Error("æ— æ³•è¯»å–å‰ªè´´æ¿")}}static getMemoryUsage(){if("memory"in performance){const e=performance.memory;return`${(e.usedJSHeapSize/1048576).toFixed(2)} MB / ${(e.totalJSHeapSize/1048576).toFixed(2)} MB`}return"ä¸å¯ç”¨"}static makeDraggable(e){let t,o,n,s,l=!1;const r=e.querySelector(".panel-header");r&&(r.style.cursor="move",r.addEventListener("mousedown",t=>{t.target.classList.contains("close-btn")||(l=!0,n=t.clientX-e.offsetLeft,s=t.clientY-e.offsetTop)}),document.addEventListener("mousemove",r=>{l&&(r.preventDefault(),t=r.clientX-n,o=r.clientY-s,e.style.left=`${t}px`,e.style.top=`${o}px`,e.style.right="auto",e.style.bottom="auto")}),document.addEventListener("mouseup",()=>{l=!1}))}}e.DEFAULT_SELECTORS=[{hostname:"chat.openai.com",copyButtonSelector:'button[aria-label*="Copy"]',responseContainerSelector:'[data-message-author-role="assistant"]',name:"ChatGPT"},{hostname:"claude.ai",copyButtonSelector:'button[data-testid="action-bar-copy"]',responseContainerSelector:void 0,name:"Claude"},{hostname:"gemini.google.com",copyButtonSelector:'button[aria-label="Copy"]',responseContainerSelector:".model-response",name:"Gemini"},{hostname:"perplexity.ai",copyButtonSelector:'button[aria-label="Copy"]',responseContainerSelector:void 0,name:"Perplexity"},{hostname:"aistudio.google.com",copyButtonSelector:'button[mat-menu-item][jslog^="282205"]',responseContainerSelector:void 0,name:"AI Studio"}],new class{constructor(){this.panel=null,this.statusElement=null,this.enabled=!1,this.dailyCounter=1,this.promptButtons=null,this.isDebugMode=!1,this.initialize(),this.checkDebugMode()}checkDebugMode(){this.isDebugMode=window.location.search.includes("debug=true")||"true"===localStorage.getItem("ai-vscode-debug")||"localhost"===window.location.hostname}debugLog(e,...t){this.isDebugMode&&console.log(e,...t)}debugWarn(e,...t){this.isDebugMode&&console.warn(e,...t)}async initialize(){await this.checkAndInitialize(),await this.loadDailyCounter(),this.queryConnectionStatus()}queryConnectionStatus(){chrome.runtime.sendMessage({action:"getConnectionStatus"},e=>{chrome.runtime.lastError?console.error("æŸ¥è¯¢è¿æ¥çŠ¶æ€å¤±è´¥:",chrome.runtime.lastError):e&&void 0!==e.connected&&(console.log("å½“å‰è¿æ¥çŠ¶æ€:",e.connected?"å·²è¿æ¥":"æœªè¿æ¥"),this.updateConnectionStatus(e.connected))})}async loadDailyCounter(){const e=(new Date).toDateString(),t=await chrome.storage.local.get(["lastSaveDate","dailyCounter"]);t.lastSaveDate===e?this.dailyCounter=(t.dailyCounter||0)+1:this.dailyCounter=1}async updateDailyCounter(){const e=(new Date).toDateString();await chrome.storage.local.set({lastSaveDate:e,dailyCounter:this.dailyCounter}),this.dailyCounter++}async checkAndInitialize(){const e=await chrome.storage.sync.get({enabledUrls:["chat.openai.com","claude.ai","gemini.google.com","perplexity.ai"],showOnAllSites:!1}),t=window.location.hostname,o=e.showOnAllSites,n=e.enabledUrls;o||this.isUrlEnabled(t,n)?(this.enabled=!0,this.createPanel(),this.setupMessageListener(),console.log("âœ… æ‚¬æµ®çª—å·²å¯ç”¨")):console.log("å½“å‰ç½‘ç«™æœªå¯ç”¨æ‚¬æµ®çª—:",t),chrome.storage.onChanged.addListener(e=>{(e.enabledUrls||e.showOnAllSites||e.siteConfigs)&&window.location.reload()})}isUrlEnabled(e,t){return t.some(t=>{if(t.includes("*")){const o=t.replace(/\*/g,".*");return new RegExp(o).test(e)}return e.includes(t)})}createPanel(){this.panel=document.createElement("div"),this.panel.id="ai-vscode-panel",this.panel.innerHTML='\n    <div class="panel-container">\n      <div class="ai-vscode-header">\n        <span class="ai-vscode-title">å‘é€åˆ°VS Code</span>\n        <button id="toggle-prompts" class="ai-vscode-toggle" title="æŠ˜å /å±•å¼€æç¤ºè¯">â–¾</button>\n        <button id="close-panel" class="ai-vscode-close">âœ•</button>\n      </div>\n      <div id="filename-preview" class="filename-preview">æ–‡ä»¶åé¢„è§ˆ...</div>\n\n      <div id="prompt-section">\n        <div class="prompt-section-header">\n          <span>å¸¸ç”¨æç¤ºè¯</span>\n        </div>\n        <div id="prompt-buttons" class="prompt-buttons"></div>\n      </div>\n\n      <div class="ai-vscode-footer">\n        <button id="send-to-vscode" class="primary">å¤åˆ¶å¹¶ä¿å­˜</button>\n        <div id="connection-status" class="connection-status">\n          <span class="status-dot"></span>\n          <span class="status-text">æœªè¿æ¥</span>\n        </div>\n      </div>\n    </div>\n  ',document.body.appendChild(this.panel),e.makeDraggable(this.panel);const t=document.getElementById("send-to-vscode");t?.addEventListener("click",()=>this.handleSendClick());const o=document.getElementById("close-panel");o?.addEventListener("click",()=>this.togglePanel());const n=document.getElementById("toggle-prompts"),s=document.getElementById("prompt-section");n&&s&&(n.addEventListener("click",()=>{const e=s.classList.toggle("collapsed");n.textContent=e?"â–¸":"â–¾",chrome.storage.local.set({promptsCollapsed:e})}),chrome.storage.local.get("promptsCollapsed",e=>{e.promptsCollapsed&&(s.classList.add("collapsed"),n.textContent="â–¸")})),this.statusElement=document.getElementById("connection-status"),this.promptButtons=document.getElementById("prompt-buttons"),this.loadPromptButtons()}togglePanel(){this.panel&&(this.panel.style.display="none"===this.panel.style.display?"block":"none")}async handleSendClick(){const t=performance.now();console.group("ğŸš€ [å¤åˆ¶å¹¶ä¿å­˜] å®Œæ•´æµç¨‹"),console.log("â±ï¸ å¼€å§‹æ—¶é—´:",(new Date).toLocaleTimeString()),console.log("ğŸ’¾ åˆå§‹å†…å­˜:",this.getMemoryUsage());try{if(window.location.hostname.includes("aistudio.google.com"))return await this.handleAIStudioCopy(),void console.groupEnd();console.log("\nğŸ“ æ­¥éª¤1: æŸ¥æ‰¾å¤åˆ¶æŒ‰é’®");const o=e.findLatestCopyButton();if(!o)return console.error("âŒ æœªæ‰¾åˆ°COPYæŒ‰é’®"),this.showError("æœªæ‰¾åˆ°COPYæŒ‰é’®"),void console.groupEnd();console.log("\nğŸ“ æ­¥éª¤2: ç‚¹å‡»å¤åˆ¶æŒ‰é’®"),console.time("ç‚¹å‡»å¤åˆ¶"),o.click(),console.timeEnd("ç‚¹å‡»å¤åˆ¶"),console.log("\nğŸ“ æ­¥éª¤3: ç­‰å¾…å¤åˆ¶å®Œæˆ (300ms)"),await this.delay(300),console.log("\nğŸ“ æ­¥éª¤4: è¯»å–å‰ªè´´æ¿");const n=await e.getClipboardContent();if(!n||0===n.trim().length)return console.error("âŒ å‰ªè´´æ¿å†…å®¹ä¸ºç©º"),this.showError("å‰ªè´´æ¿å†…å®¹ä¸ºç©º"),void console.groupEnd();console.log("\nğŸ“ æ­¥éª¤5: ç”Ÿæˆæ–‡ä»¶å"),console.time("ç”Ÿæˆæ–‡ä»¶å");const s=this.generateSmartFilename(n);console.timeEnd("ç”Ÿæˆæ–‡ä»¶å"),console.log("ğŸ“ æ–‡ä»¶å:",s),console.log("\nğŸ“ æ­¥éª¤6: å‘é€åˆ°VS Code"),this.showFilenamePreview(s),this.sendToVSCode(n,s),console.log("\nğŸ“ æ­¥éª¤7: æ›´æ–°è®¡æ•°å™¨"),await this.updateDailyCounter();const l=performance.now();console.log("\nâœ… æµç¨‹å®Œæˆ"),console.log("â±ï¸ æ€»è€—æ—¶:",(l-t).toFixed(2),"ms"),console.log("ğŸ’¾ ç»“æŸå†…å­˜:",this.getMemoryUsage()),console.groupEnd()}catch(e){const t=e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯";console.error("âŒ æµç¨‹å¤±è´¥:",e),console.log("ğŸ’¾ é”™è¯¯æ—¶å†…å­˜:",this.getMemoryUsage()),this.showError(`æ“ä½œå¤±è´¥ï¼š${t}`),console.groupEnd()}}getMemoryUsage(){return"memory"in performance?`${(performance.memory.usedJSHeapSize/1048576).toFixed(2)} MB`:"ä¸å¯ç”¨"}async handleAIStudioCopy(){try{this.debugLog("ğŸ” AI Studio ç‰¹æ®Šå¤„ç†ï¼šæŸ¥æ‰¾èœå•æŒ‰é’®");const t=Array.from(document.querySelectorAll('button[aria-label*="options"], button[iconname="more_vert"], button[aria-label*="Open options"], ms-chat-turn-options button'));if(0===t.length)return void this.showError("æœªæ‰¾åˆ°èœå•æŒ‰é’®");const o=t[t.length-1];this.debugLog("âœ… æ‰¾åˆ°èœå•æŒ‰é’®ï¼Œå‡†å¤‡ç‚¹å‡»"),o.click(),this.debugLog("âœ… èœå•å·²å±•å¼€ï¼Œç­‰å¾…åŠ è½½..."),await this.delay(500);const n=e.findLatestCopyButton();if(!n)return console.error("âŒ èœå•å±•å¼€åä»æœªæ‰¾åˆ°å¤åˆ¶æŒ‰é’®"),this.showError("æœªæ‰¾åˆ°å¤åˆ¶æŒ‰é’®"),void o.click();this.debugLog("âœ… æ‰¾åˆ°å¤åˆ¶æŒ‰é’®ï¼Œå‡†å¤‡ç‚¹å‡»"),n.click(),await this.delay(300);const s=await e.getClipboardContent();if(!s||0===s.trim().length)return void this.showError("å‰ªè´´æ¿å†…å®¹ä¸ºç©º");if(this.debugLog("âœ… è¯»å–åˆ°å†…å®¹ï¼Œé•¿åº¦:",s.length),s.length>5e4)return void this.showError("å¯¹è¯å†…å®¹è¿‡é•¿ï¼Œæ— æ³•ç›´æ¥å¤åˆ¶ï¼Œè¯·åˆ†æ‰¹æ“ä½œï¼");const l=this.generateSmartFilename(s);this.debugLog("ğŸ“ ç”Ÿæˆæ–‡ä»¶å:",l),this.showFilenamePreview(l),this.sendToVSCode(s,l),await this.updateDailyCounter()}catch(e){const t=e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯";console.error("AI Studio å¤åˆ¶å¤±è´¥:",e),this.showError(`æ“ä½œå¤±è´¥ï¼š${t}`)}}generateSmartFilename(e){const t=new Date,o=t.getFullYear()+String(t.getMonth()+1).padStart(2,"0")+String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0")+String(t.getMinutes()).padStart(2,"0")+String(t.getSeconds()).padStart(2,"0"),s=String(this.dailyCounter).padStart(3,"0"),l=this.extractFirstSentence(e),r=this.cleanSentence(l);return`${o}-${n}-${s}-${this.truncateFilename(r,50)}.md`}extractFirstSentence(e){let t=e.trim();t=t.replace(/^#+\s+/gm,""),t=t.replace(/\*\*(.+?)\*\*/g,"$1"),t=t.replace(/\*(.+?)\*/g,"$1"),t=t.replace(/`(.+?)`/g,"$1"),t=t.replace(/\[(.+?)\]\(.+?\)/g,"$1");const o=t.split(/[ã€‚.!?ï¼ï¼Ÿ\n]/);for(const e of o){const t=e.trim();if(t.length>5)return t}return t.substring(0,50).trim()}cleanSentence(e){const t=[/^å¥½çš„[ï¼!ï¼Œ,ã€‚.\s]*/i,/^å½“ç„¶[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æˆ‘ä¼š[^\s]{0,5}/i,/^æˆ‘å°†[^\s]{0,5}/i,/^è®©æˆ‘[^\s]{0,5}/i,/^æ˜ç™½[äº†å—]?[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æ”¶åˆ°[ï¼!ï¼Œ,ã€‚.\s]*/i,/^å¥½[çš„å•¦][ï¼!ï¼Œ,ã€‚.\s]*/i,/^OK[ï¼!ï¼Œ,ã€‚.\s]*/i,/^äº†è§£[ï¼!ï¼Œ,ã€‚.\s]*/i,/^æ²¡é—®é¢˜[ï¼!ï¼Œ,ã€‚.\s]*/i];let o=e;for(const e of t)o=o.replace(e,"");return o=o.replace(/[<>:"/\\|?*\x00-\x1F]/g,""),o=o.replace(/\s+/g,"-"),o=o.replace(/^-+|-+$/g,""),o}truncateFilename(e,t){if(e.length<=t)return e;let o=e.substring(0,t);const n=o.lastIndexOf("-");return n>.7*t&&(o=o.substring(0,n)),o}showFilenamePreview(e){const t=document.getElementById("filename-preview");t&&(t.textContent=`ğŸ“„ ${e}`,t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3))}async sendToVSCode(e,t){try{const o=((await chrome.storage.sync.get({savePath:""})).savePath||"").trim(),n={action:"sendToVSCode",content:e,filename:t,savePath:o};console.log("ğŸ“¤ å‘é€åˆ° VS Code:",{filename:t,savePath:o||"(æ ¹ç›®å½•)",contentLength:e.length});const s=setTimeout(()=>{this.showError("å‘é€è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ VS Code æ˜¯å¦å·²å¯åŠ¨ WebSocket æœåŠ¡")},5e3);chrome.runtime.sendMessage(n,e=>{if(clearTimeout(s),chrome.runtime.lastError)return console.error("âŒ æ‰©å±•é€šä¿¡å¤±è´¥:",chrome.runtime.lastError),void this.showError("æ‰©å±•é€šä¿¡å¤±è´¥ï¼Œè¯·é‡æ–°åŠ è½½é¡µé¢");if(e&&e.success){const e=o?` â†’ ${o}/`:" â†’ æ ¹ç›®å½•/";this.showSuccess(`âœ… å·²ä¿å­˜: ${e}${t}`),console.log("âœ… æ–‡ä»¶ä¿å­˜æˆåŠŸ")}else{const t=e?.error||"æœªçŸ¥é”™è¯¯";console.error("âŒ ä¿å­˜å¤±è´¥:",t),this.showError(`ä¿å­˜å¤±è´¥ï¼š${t}`)}})}catch(e){console.error("âŒ sendToVSCode å‡ºé”™:",e),this.showError("å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•")}}setupMessageListener(){chrome.runtime.onMessage.addListener(e=>{"connectionStatus"===e.type&&this.updateConnectionStatus("connected"===e.status)})}updateConnectionStatus(e){if(!this.statusElement)return;const t=this.statusElement.querySelector(".status-text"),o=this.statusElement.querySelector(".status-dot");e?(this.statusElement.classList.add("connected"),t&&(t.textContent="å·²è¿æ¥"),o&&o.classList.add("active")):(this.statusElement.classList.remove("connected"),t&&(t.textContent="æœªè¿æ¥"),o&&o.classList.remove("active"))}showSuccess(e){this.showNotification(e,"success")}showError(e){this.showNotification(e,"error")}showNotification(e,t){const o=document.createElement("div");o.className=`notification ${t}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>o.remove(),3e3)}delay(e){return new Promise(t=>setTimeout(t,e))}async loadPromptButtons(){try{let e=(await chrome.storage.local.get(["promptFiles"])).promptFiles||[];0===e.length&&(e=(await chrome.storage.sync.get(["promptFiles"])).promptFiles||[],e.length>0&&console.log("ä» sync åŠ è½½æç¤ºè¯ï¼ˆæ—§æ ¼å¼ï¼‰")),this.createPromptButtons(e)}catch(e){console.error("åŠ è½½æç¤ºè¯å¤±è´¥:",e)}}createPromptButtons(e){this.promptButtons&&0!==e.length&&(this.promptButtons.innerHTML=e.filter(e=>e.enabled).map(e=>`\n        <button \n          class="prompt-btn" \n          data-prompt-id="${e.id}"\n          data-prompt-name="${this.escapeHtml(e.name)}"\n          style="\n            padding: 8px 12px;\n            background: #6c5ce7;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            text-align: left;\n          "\n          onmouseover="this.style.background='#5f4dd1'"\n          onmouseout="this.style.background='#6c5ce7'"\n        >\n          ğŸ“ ${this.escapeHtml(e.name)}\n        </button>\n      `).join(""),this.promptButtons.querySelectorAll(".prompt-btn").forEach((t,o)=>{t.__promptContent=e.filter(e=>e.enabled)[o].path,t.addEventListener("click",e=>{const t=e.currentTarget,o=t.__promptContent,n=t.getAttribute("data-prompt-name");o&&this.applyPrompt(o,n||"")})}))}async applyPrompt(e,t){try{if(console.log("ğŸ“ å¼€å§‹åº”ç”¨æç¤ºè¯:",t),!e||0===e.trim().length)return void this.showError("æç¤ºè¯å†…å®¹ä¸ºç©º");console.log("âœ… å†…å®¹é•¿åº¦:",e.length);const o=document.querySelector('button[data-test-system-instructions-card], button[aria-label="System instructions"], button.system-instructions-card');if(!o)return void this.showError("æœªæ‰¾åˆ° System Instructions æŒ‰é’®");console.log("âœ… æ‰¾åˆ° System Instructions æŒ‰é’®"),o.click(),await this.delay(500);const n=document.querySelector('textarea[aria-label="System instructions"], textarea[placeholder*="tone and style"], textarea.in-run-settings');if(!n)return this.showError("æœªæ‰¾åˆ°æ–‡æœ¬æ¡†"),void this.closeSystemInstructionsDialog();console.log("âœ… æ‰¾åˆ°æ–‡æœ¬æ¡†"),n.value="",n.value=e,n.blur(),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),n.dispatchEvent(new Event("blur",{bubbles:!0}));const s=new CustomEvent("input",{bubbles:!0,cancelable:!0});n.dispatchEvent(s),console.log("âœ… å†…å®¹å·²å¡«å……"),await this.delay(800),this.closeSystemInstructionsDialog(),this.showSuccess(`âœ… å·²åº”ç”¨: ${t}`)}catch(e){const t=e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯";console.error("åº”ç”¨æç¤ºè¯å¤±è´¥:",e),this.showError(`åº”ç”¨å¤±è´¥ï¼š${t}`)}}closeSystemInstructionsDialog(){const e=["button[data-test-close-button]",'button[aria-label="Close panel"]',"button[mat-dialog-close]",'button[iconname="close"]','button.ms-button-icon[iconname="close"]','button[aria-label="Close panel"][data-test-close-button]'];let t=null;for(const o of e)if(t=document.querySelector(o),t&&null!==t.offsetParent){console.log(`âœ… æ‰¾åˆ°å…³é—­æŒ‰é’®: ${o}`);break}if(t){const e=null!==t.offsetParent,o=t.hasAttribute("aria-disabled")&&"true"===t.getAttribute("aria-disabled"),n="false"===t.getAttribute("aria-disabled")||!t.hasAttribute("aria-disabled");if(console.log("å…³é—­æŒ‰é’®çŠ¶æ€:",{isVisible:e,isDisabled:o,isEnabled:n,ariaDisabled:t.getAttribute("aria-disabled"),className:t.className}),e&&n)try{t.click(),console.log("âœ… å·²è‡ªåŠ¨å…³é—­System Instructionsç•Œé¢")}catch(e){console.error("ç‚¹å‡»å…³é—­æŒ‰é’®å¤±è´¥:",e);const o=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(o),console.log("âœ… å·²é€šè¿‡äº‹ä»¶è§¦å‘å…³é—­System Instructionsç•Œé¢")}else console.warn("âŒ å…³é—­æŒ‰é’®ä¸å¯ç”¨æˆ–å·²ç¦ç”¨",{isVisible:e,isDisabled:o,isEnabled:n})}else{console.warn("âŒ æœªæ‰¾åˆ°å¯ç”¨çš„å…³é—­æŒ‰é’®");const e=document.querySelectorAll("button");console.log("é¡µé¢ä¸Šçš„æ‰€æœ‰æŒ‰é’®:",Array.from(e).map(e=>({tagName:e.tagName,className:e.className,ariaLabel:e.getAttribute("aria-label"),dataTest:e.getAttribute("data-test-close-button"),iconName:e.getAttribute("iconname"),matDialogClose:e.getAttribute("mat-dialog-close")})))}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}})();
//# sourceMappingURL=content.js.map